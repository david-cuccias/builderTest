{"version":3,"file":"builder-react-lite.cjs.js","sources":["../src/scripts/init-editing.ts","../src/constants/device-sizes.constant.ts","../src/functions/set.ts","../src/functions/safe-dynamic-require.ts","../src/functions/string-to-function.ts","../src/store/builder-async-requests.ts","../src/store/builder-store.ts","../src/functions/apply-patch-with-mutation.ts","../src/functions/block-to-html-string.ts","../src/components/Link.tsx","../src/components/builder-block.component.tsx","../src/components/builder-blocks.component.tsx","../src/components/no-wrap.tsx","../src/components/variants-provider.component.tsx","../src/components/builder-content.component.tsx","../lib/on-change.js","../src/functions/debonce-next-tick.ts","../src/functions/throttle.ts","../src/store/builder-meta.ts","../src/components/builder-page.component.tsx","../src/functions/with-children.tsx","../src/builder-react-lite.ts"],"sourcesContent":["import { version } from '../../package.json';\n\nif (typeof window !== 'undefined') {\n  window.parent?.postMessage(\n    {\n      type: 'builder.isReactSdk',\n      data: {\n        value: true,\n        supportsPatchUpdates: 'v3',\n        priorVersion: version,\n      },\n    },\n    '*'\n  );\n}\n","export type Size = 'large' | 'medium' | 'small' | 'xsmall';\nexport const sizeNames: Size[] = ['xsmall', 'small', 'medium', 'large'];\n\n// TODO: put in @builder.io/core\nexport const sizes = {\n  xsmall: {\n    min: 0,\n    default: 0,\n    max: 0,\n  },\n  small: {\n    min: 320,\n    default: 321,\n    max: 640,\n  },\n  medium: {\n    min: 641,\n    default: 642,\n    max: 991,\n  },\n  large: {\n    min: 990,\n    default: 991,\n    max: 1200,\n  },\n  getWidthForSize(size: Size) {\n    return this[size].default;\n  },\n  getSizeForWidth(width: number) {\n    for (const size of sizeNames) {\n      const value = this[size];\n      if (width <= value.max) {\n        return size;\n      }\n    }\n    return 'large';\n  },\n};\n","export const set = (obj: any, _path: string | string[], value: any) => {\n  if (Object(obj) !== obj) {\n    return obj;\n  }\n  const path: string[] = Array.isArray(_path)\n    ? _path\n    : (_path.toString().match(/[^.[\\]]+/g) as string[]);\n\n  path\n    .slice(0, -1)\n    .reduce(\n      (a, c, i) =>\n        Object(a[c]) === a[c]\n          ? a[c]\n          : (a[c] = Math.abs(Number(path[i + 1])) >> 0 === +path[i + 1] ? [] : {}),\n      obj\n    )[path[path.length - 1]] = value;\n  return obj;\n};\n","'use strict';\n\nimport { Builder } from '@builder.io/sdk';\n\n// Allow us to require things dynamically safe from webpack bundling\nexport const safeDynamicRequire: typeof require = Builder.isServer\n  ? eval('require')\n  : ((() => null) as any);\n","import { Builder, builder } from '@builder.io/sdk';\nimport { safeDynamicRequire } from './safe-dynamic-require';\n\nconst fnCache: { [key: string]: BuilderEvanFunction | undefined } = {};\n\nconst sizeMap = {\n  desktop: 'large',\n  tablet: 'medium',\n  mobile: 'small',\n};\n\ntype BuilderEvanFunction = (\n  state: object,\n  event?: Event | undefined | null,\n  block?: any,\n  builder?: Builder,\n  Device?: any,\n  update?: Function | null,\n  _Builder?: typeof Builder,\n  context?: object\n) => any;\n\nexport const api = (state: any) => builder;\n\nexport function stringToFunction(\n  str: string,\n  expression = true,\n  errors?: Error[],\n  logs?: string[]\n): BuilderEvanFunction {\n  /* TODO: objedct */\n  if (!str || !str.trim()) {\n    return () => undefined;\n  }\n\n  const cacheKey = str + ':' + expression;\n  if (fnCache[cacheKey]) {\n    return fnCache[cacheKey]!;\n  }\n\n  // FIXME: gross hack\n  const useReturn =\n    (expression &&\n      !(str.includes(';') || str.includes(' return ') || str.trim().startsWith('return '))) ||\n    str.trim().startsWith('builder.run');\n  let fn: Function = () => {\n    /* intentionally empty */\n  };\n\n  str = str\n    .replace(/builder\\s*\\.\\s*use[a-zA-Z]*\\(/g, 'return(')\n    .replace(/builder\\s*\\.\\s*set([a-zA-Z]+)To\\(/g, (_match, group: string) => {\n      return `builder.set(\"${group[0].toLowerCase() + group.substring(1)}\",`;\n    })\n    .replace(/builder\\s*\\.\\s*get([a-zA-Z]+)\\s*\\(\\s*\\)/g, (_match, group: string) => {\n      return `state.${group[0].toLowerCase() + group.substring(1)}`;\n    });\n\n  try {\n    // tslint:disable-next-line:no-function-constructor-with-string-args\n    if (Builder.isBrowser) {\n      // TODO: use strict and eval\n      fn = new Function(\n        'state',\n        'event',\n        'block',\n        'builder',\n        'Device',\n        'update',\n        'Builder',\n        'context',\n        // TODO: remove the with () {} - make a page v3 that doesn't use this\n        // Or only do if can't find state\\s*\\. anywhere hm\n        `\n          var names = [\n            'state',\n            'event',\n            'block',\n            'builder',\n            'Device',\n            'update',\n            'Builder',\n            'context'\n          ];\n          var rootState = state;\n          if (typeof Proxy !== 'undefined') {\n            rootState = new Proxy(rootState, {\n              set: function () {\n                return false;\n              },\n              get: function (target, key) {\n                if (names.includes(key)) {\n                  return undefined;\n                }\n                return target[key];\n              }\n            });\n          }\n          /* Alias */\n          var ctx = context;\n          with (rootState) {\n            ${useReturn ? `return (${str});` : str};\n          }\n        `\n      );\n    }\n  } catch (error) {\n    if (errors) {\n      errors.push(error);\n    }\n    const message = error && error.message;\n    if (message && typeof message === 'string') {\n      if (logs && logs.indexOf(message) === -1) {\n        logs.push(message);\n      }\n    }\n    if (Builder.isBrowser) {\n      console.warn(`Function compile error in ${str}`, error);\n    }\n  }\n\n  const final = (fnCache[cacheKey] = (...args: any[]) => {\n    try {\n      if (Builder.isBrowser) {\n        return fn(...args);\n      } else {\n        // TODO: memoize on server\n        // TODO: use something like this instead https://www.npmjs.com/package/rollup-plugin-strip-blocks\n        // There must be something more widely used?\n        // TODO: regex for between comments instead so can still type check the code... e.g. //SERVER-START ... code ... //SERVER-END\n        // Below is a hack to get certain code to *only* load in the server build, to not screw with\n        // browser bundler's like rollup and webpack. Our rollup plugin strips these comments only\n        // for the server build\n        // TODO: cache these for better performancs with new VmScript\n        // tslint:disable:comment-format\n        const { VM } = safeDynamicRequire('vm2');\n        const [state, event] = args;\n        return new VM({\n          timeout: 100,\n          sandbox: {\n            ...state,\n            ...{ state },\n            ...{ builder: api },\n            event,\n          },\n        }).run(str.replace(/(^|;)return /, '$1'));\n        // tslint:enable:comment-format\n      }\n    } catch (error) {\n      if (Builder.isBrowser) {\n        console.warn(\n          'Builder custom code error:',\n          error.message || error,\n          'in',\n          str,\n          error.stack || error\n        );\n      } else {\n        if (process.env.DEBUG) {\n          console.debug(\n            'Builder custom code error:',\n            error.message || error,\n            'in',\n            str,\n            error.stack || error\n          );\n        }\n      }\n      if (errors) {\n        errors.push(error);\n      }\n    }\n  });\n\n  return final;\n}\n","import React from 'react';\n\nexport interface RequestInfo {\n  promise: Promise<any>;\n  url?: string;\n}\n\nexport type RequestOrPromise = RequestInfo | Promise<any>;\n\nexport const isPromise = (thing: RequestOrPromise): thing is Promise<any> =>\n  typeof (thing as any).then === 'function';\nexport const isRequestInfo = (thing: RequestOrPromise): thing is RequestInfo => !isPromise(thing);\n\nexport const BuilderAsyncRequestsContext = React.createContext({\n  requests: [] as RequestOrPromise[],\n  errors: [] as Error[],\n  logs: [] as string[],\n});\n","import React from 'react';\n\nexport const BuilderStoreContext = React.createContext<BuilderStore>({\n  state: {},\n  rootState: {},\n  content: {},\n  context: {},\n  update: (mutator: (state: any) => any) => null,\n});\n\nexport interface BuilderStore {\n  state: any;\n  rootState: any;\n  content: any;\n  context: any;\n  update: (mutator: (state: any) => any) => any;\n  renderLink?: (props: React.AnchorHTMLAttributes<any>) => React.ReactNode;\n}\n","export const applyPatchWithMinimalMutationChain = (\n  obj: any,\n  patch: { path: string; op: 'add' | 'remove' | 'replace'; value: any },\n  preserveRoot = true\n) => {\n  if (Object(obj) !== obj) {\n    return obj;\n  }\n  const { path, op, value } = patch;\n  const pathArr: string[] = path.split(/\\//);\n  if (pathArr[0] === '') {\n    pathArr.shift();\n  }\n\n  const newObj = preserveRoot ? obj : { ...obj };\n  let objPart = newObj;\n  for (let i = 0; i < pathArr.length; i++) {\n    const isLast = i === pathArr.length - 1;\n    const property = pathArr[i];\n    if (isLast) {\n      if (op === 'replace') {\n        objPart[property] = value;\n      } else if (op === 'add') {\n        const index = Number(property);\n        if (Array.isArray(objPart)) {\n          if (property === '-') {\n            objPart.push(value);\n          } else {\n            objPart.splice(index, 0, value);\n          }\n        } else {\n          objPart[property] = value;\n        }\n      } else if (op === 'remove') {\n        const index = Number(property);\n        if (Array.isArray(objPart)) {\n          objPart.splice(index, 1);\n        } else {\n          delete objPart[property];\n        }\n      }\n    } else {\n      const nextProperty = pathArr[i + 1];\n      const newPart =\n        Object(objPart[property]) === objPart[property]\n          ? objPart[property]\n          : String(Number(nextProperty)) === nextProperty\n          ? []\n          : {};\n      objPart = objPart[property] = Array.isArray(newPart) ? [...newPart] : { ...newPart };\n    }\n  }\n\n  return newObj;\n};\n","import { BuilderElement } from '@builder.io/sdk';\n\nexport const htmlEscape = (str: string) =>\n  str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\n// TODO: handle self closing tags\n// TODO: how allow components (e.g. react components) in templates?\nexport const blockToHtmlString = (block: BuilderElement): string =>\n  `<${htmlEscape(block.tagName || 'div')} \n    class=\"builder-block ${block.id} ${block.class || ''}\"\n    builder-id=\"${block.id}\"\n  ${Object.keys(block.properties || {})\n    .map(key => `${htmlEscape(key)}=\"${htmlEscape(block.properties![key])}\"`)\n    .join(' ')}\n  >${\n    block?.component?.name === 'Text'\n      ? block.component.options.text\n      : block.children\n      ? block.children.map(item => blockToHtmlString(item)).join('')\n      : ''\n  }</${block.tagName || 'div'}>`.replace(/\\s+/g, ' ');\n","import React from 'react';\nimport { BuilderStoreContext } from '../store/builder-store';\n/**\n * Link component should be used instead of an anchor tag in our components,\n * this is to allow our users to override anchor tags in\n * case they're using a routing Lib that requires using their\n * custom Link component (e.g Next, Gatsby, React Router)\n * <BuilderComponent renderLink=(props) => <myCustomLink {...props} /> />\n */\nexport const Link: React.SFC<React.AnchorHTMLAttributes<HTMLAnchorElement>> = props => (\n  <BuilderStoreContext.Consumer>\n    {context => {\n      if (context.renderLink) {\n        return context.renderLink(props);\n      }\n      return <a {...props} />;\n    }}\n  </BuilderStoreContext.Consumer>\n);\n","/** @jsx jsx */\n\nimport { Builder, builder, BuilderElement, Component } from '@builder.io/sdk';\nimport { ClassNames, jsx } from '@emotion/core';\nimport React from 'react';\nimport { Size, sizeNames, sizes } from '../constants/device-sizes.constant';\nimport { set } from '../functions/set';\nimport { api, stringToFunction } from '../functions/string-to-function';\nimport { BuilderAsyncRequestsContext, RequestOrPromise } from '../store/builder-async-requests';\nimport { BuilderStoreContext } from '../store/builder-store';\nimport { applyPatchWithMinimalMutationChain } from '../functions/apply-patch-with-mutation';\nimport { blockToHtmlString } from '../functions/block-to-html-string';\nimport { Link } from './Link';\n\nconst camelCaseToKebabCase = (str?: string) =>\n  str ? str.replace(/([A-Z])/g, g => `-${g[0].toLowerCase()}`) : '';\n\nconst kebabCaseToCamelCase = (str = '') =>\n  str.replace(/-([a-z])/g, match => match[1].toUpperCase());\n\nconst Device = { desktop: 0, tablet: 1, mobile: 2 };\nconst blocksMap: Record<string, BuilderElement> = {};\n\nconst voidElements = new Set([\n  'area',\n  'base',\n  'br',\n  'col',\n  'embed',\n  'hr',\n  'img',\n  'input',\n  'link',\n  'meta',\n  'param',\n  'source',\n  'track',\n  'wbr',\n]);\n\nfunction pick(object: any, keys: string[]) {\n  return keys.reduce((obj, key) => {\n    if (object && object.hasOwnProperty(key)) {\n      (obj as any)[key] = object[key];\n    }\n    return obj;\n  }, {});\n}\n\nconst last = <T extends any>(arr: T[]) => arr[arr.length - 1];\n\nfunction omit(obj: any, values: string[]) {\n  const newObject = Object.assign({}, obj);\n  for (const key of values) {\n    delete newObject[key];\n  }\n  return newObject;\n}\n\nconst cssCase = (property: string) => {\n  if (!property) {\n    return property;\n  }\n\n  let str = camelCaseToKebabCase(property);\n\n  if (property[0] === property[0].toUpperCase()) {\n    str = '-' + str;\n  }\n\n  return str;\n};\n\n// TODO: pull from builer internal utils\nconst fastClone = (obj: object) => JSON.parse(JSON.stringify(obj));\n\n// TODO: share these types in shared\ntype ElementType = any;\n\ninterface StringMap {\n  [key: string]: string | undefined | null;\n}\nfunction mapToCss(map: StringMap, spaces = 2, important = false) {\n  return Object.keys(map).reduce((memo, key) => {\n    const value = map[key];\n    if (typeof value !== 'string') {\n      return memo;\n    }\n    return (\n      memo +\n      (value && value.trim()\n        ? `\\n${' '.repeat(spaces)}${cssCase(key)}: ${value + (important ? ' !important' : '')};`\n        : '')\n    );\n  }, '');\n}\n\nexport interface BuilderBlockProps {\n  fieldName?: string;\n  block: BuilderElement;\n  // TODO:\n  // block: BuilderElement\n  child?: boolean;\n  index?: number;\n  size?: Size;\n  emailMode?: boolean;\n  // TODO: use context\n}\n\nfunction capitalize(str: string) {\n  if (!str) {\n    return;\n  }\n  return str[0].toUpperCase() + str.slice(1);\n}\n\ninterface BuilderBlockState {\n  state: any;\n  rootState: any;\n  context: any;\n  update: Function;\n}\n\nexport class BuilderBlock extends React.Component<\n  BuilderBlockProps,\n  { hasError: boolean; updates: number }\n> {\n  private _asyncRequests?: RequestOrPromise[];\n  private _errors?: Error[];\n  private _logs?: string[];\n\n  state = {\n    hasError: false,\n    updates: 0,\n  };\n\n  private privateState: BuilderBlockState = {\n    state: {},\n    rootState: {},\n    context: {},\n    update: () => {\n      /* Intentionally empty */\n    },\n  };\n\n  get store() {\n    return this.privateState;\n  }\n\n  static getDerivedStateFromError(error: any) {\n    return { hasError: true };\n  }\n\n  componentDidCatch(error: any, errorInfo: any) {\n    console.error('Builder block error:', error, errorInfo);\n  }\n\n  // TODO: handle adding return if none provided\n  // TODO: cache/memoize this (globally with LRU?)\n  stringToFunction(str: string, expression = true) {\n    return stringToFunction(str, expression, this._errors, this._logs);\n  }\n\n  get block() {\n    return blocksMap[this.props.block.id!] || this.props.block;\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps: BuilderBlockProps) {\n    // Always keep our blocks map fresh\n    if (Builder.isEditing && blocksMap[nextProps.block.id!] !== nextProps.block) {\n      blocksMap[nextProps.block.id!] = nextProps.block;\n    }\n  }\n\n  get styles() {\n    // TODO: handle style bindings\n    const { size } = this.props;\n    const block = this.block;\n    const styles = [];\n    const startIndex = sizeNames.indexOf(size || 'large');\n    if (block.responsiveStyles) {\n      for (let i = startIndex; i < sizeNames.length; i = i + 1) {\n        const name = sizeNames[i];\n        if (block.responsiveStyles[name]) {\n          styles.push(block.responsiveStyles[name]);\n        }\n      }\n    }\n\n    // On the server apply the initial animation state (TODO: maybe not for load time hm)\n    // TODO: maybe /s/ server renders content pages hmm\n    const isServer = !!this.privateState.state.isServer;\n    let initialAnimationStepStyles: any;\n    if (isServer) {\n      const animation = block.animations && block.animations[0];\n      const firstStep = animation && animation.steps && animation.steps[0];\n      const stepStyles = firstStep && firstStep.styles;\n      if (stepStyles) {\n        initialAnimationStepStyles = stepStyles;\n      }\n    }\n    return Object.assign({}, ...styles.reverse(), initialAnimationStepStyles);\n  }\n\n  get emotionCss() {\n    let initialAnimationStepStyles: any;\n    const { block } = this;\n    if (Builder.isServer) {\n      const animation = block.animations && block.animations[0];\n      if (animation && animation.trigger !== 'hover') {\n        const firstStep = animation && animation.steps && animation.steps[0];\n        const stepStyles = firstStep && firstStep.styles;\n        if (stepStyles) {\n          initialAnimationStepStyles = stepStyles;\n        }\n      }\n    }\n\n    const reversedNames = sizeNames.slice().reverse();\n    const self = this.block;\n    const styles: any = {};\n    if (self.responsiveStyles) {\n      for (const size of reversedNames) {\n        if (size === 'large') {\n          if (!this.props.emailMode) {\n            styles[`&.builder-block`] = Object.assign(\n              {},\n              self.responsiveStyles[size],\n              initialAnimationStepStyles\n            );\n          }\n        } else {\n          styles[`@media only screen and (max-width: ${sizes[size].max}px)`] = {\n            '&.builder-block': self.responsiveStyles[size],\n          };\n        }\n      }\n    }\n\n    const hoverAnimation =\n      block.animations && block.animations.find(item => item.trigger === 'hover');\n    if (hoverAnimation) {\n      styles[':hover'] = hoverAnimation.steps?.[1]?.styles || {};\n      // TODO: if manually has set transition property deal with that\n      // TODO: only include properties explicitly set in the animation\n      // using Object.keys(styles)\n      styles.transition = `all ${hoverAnimation.duration}s ${camelCaseToKebabCase(\n        hoverAnimation.easing\n      )}`;\n      if (hoverAnimation.delay) {\n        styles.transitionDelay = hoverAnimation.delay + 's';\n      }\n    }\n\n    return styles;\n  }\n\n  get css() {\n    // TODO: handle style bindings\n    const self = this.block;\n\n    const baseStyles: Partial<CSSStyleDeclaration> = {\n      ...(self.responsiveStyles && self.responsiveStyles.large),\n    };\n\n    let css = this.props.emailMode\n      ? ''\n      : `.builder-block.${self.id} {${mapToCss(baseStyles as StringMap)}}`;\n\n    const reversedNames = sizeNames.slice().reverse();\n    if (self.responsiveStyles) {\n      for (const size of reversedNames) {\n        if (this.props.emailMode && size === 'large') {\n          continue;\n        }\n        if (\n          size !== 'large' &&\n          size !== 'xsmall' &&\n          self.responsiveStyles[size] &&\n          Object.keys(self.responsiveStyles[size]!).length\n        ) {\n          const emailOuterSizes = ['display', 'width', 'verticalAlign'];\n          const map = self.responsiveStyles[size];\n          const outer = this.props.emailMode && pick(map, emailOuterSizes);\n          // TODO: this will not work as expected for a couple things that are handled specially,\n          // e.g. width\n          css += `\\n@media only screen and (max-width: ${sizes[size].max}px) { \\n${\n            this.props.emailMode ? '.' : '.builder-block.'\n          }${self.id + (this.props.emailMode ? '-subject' : '')} {${mapToCss(\n            this.props.emailMode ? omit(map, emailOuterSizes) : (map as any),\n            4,\n            this.props.emailMode\n          )} } }`;\n\n          if (this.props.emailMode && outer && Object.keys(outer).length) {\n            css += `\\n@media only screen and (max-width: ${sizes[size].max}px) { \\n.builder-block.${\n              self.id\n            } {${mapToCss(outer as any, 4, true)} } }`;\n          }\n        }\n      }\n    }\n\n    const animations = self.animations;\n    if (!this.privateState.state.isBrowser && animations && animations.length) {\n      const firstAnimation = animations[0];\n      if (firstAnimation) {\n        const firstStep = firstAnimation.steps && firstAnimation.steps[0];\n        if (firstStep) {\n          const firstStepStyles = firstStep.styles;\n          if (firstStepStyles) {\n            css += `\\n.builder-block.${self.id} {${mapToCss(firstStep, 2, true)}}`;\n          }\n        }\n      }\n    }\n\n    return css;\n  }\n\n  eval(str: string) {\n    const fn = this.stringToFunction(str);\n    // TODO: only one root instance of this, don't rewrap every time...\n    return fn(\n      this.privateState.state,\n      undefined,\n      this.block,\n      builder,\n      Device,\n      this.privateState.update,\n      Builder,\n      this.privateState.context\n    );\n  }\n\n  componentWillUnmount() {\n    if (Builder.isEditing) {\n      removeEventListener('message', this.onWindowMessage);\n    }\n  }\n\n  onWindowMessage = (event: MessageEvent) => {\n    const message = event.data;\n    if (!message) {\n      return;\n    }\n    switch (message.type) {\n      case 'builder.selectionChange': {\n        const { data } = message;\n        if (!data) {\n          break;\n        }\n        const { selection } = data;\n        const id = this.block && this.block.id;\n        if (id && Array.isArray(selection) && selection.indexOf(id) > -1) {\n          setTimeout(() => {\n            (window as any).$block = this;\n            if (!(window as any).$blocks) {\n              (window as any).$blocks = [];\n            }\n            (window as any).$blocks.push(this);\n          });\n        }\n        break;\n      }\n\n      case 'builder.patchUpdates': {\n        const { data } = message;\n        if (!(data && data.data)) {\n          break;\n        }\n        const patches = data.data[this.block.id!];\n        if (!patches) {\n          return;\n        }\n\n        if (location.href.includes('builder.debug=true')) {\n          this.eval('debugger');\n        }\n        let newBlock = { ...this.block };\n        for (const patch of patches) {\n          // TODO: soehow mark this.block as a new object,\n          // e.g. access it's parent hm. maybe do the listning mutations\n          // on hte parent element not the child (or rather\n          // send the message to the parent)\n          applyPatchWithMinimalMutationChain(newBlock, patch);\n        }\n        blocksMap[this.props.block.id!] = newBlock;\n        this.setState({ updates: this.state.updates + 1 });\n\n        break;\n      }\n    }\n  };\n\n  componentDidMount() {\n    const block = this.block;\n    const animations = block && block.animations;\n\n    if (Builder.isEditing) {\n      addEventListener('message', this.onWindowMessage);\n    }\n\n    // tslint:disable-next-line:comment-format\n    ///REACT15ONLY if (this.ref) { this.ref.setAttribute('builder-id', block.id); }\n\n    if (animations) {\n      const options = {\n        animations: fastClone(animations),\n      };\n\n      // TODO: listen to Builder.editingMode and bind animations when editing\n      // and unbind when not\n      // TODO: apply bindings first\n      if (block.bindings) {\n        for (const key in block.bindings) {\n          if (key.startsWith('animations.')) {\n            // TODO: this needs to run in getElement bc of local state per element for repeats\n            const value = this.stringToFunction(block.bindings[key]);\n            if (value !== undefined) {\n              set(\n                options,\n                key,\n                value(\n                  this.privateState.state,\n                  null,\n                  block,\n                  builder,\n                  null,\n                  null,\n                  Builder,\n                  this.privateState.context\n                )\n              );\n            }\n          }\n        }\n      }\n      Builder.animator.bindAnimations(\n        options.animations\n          .filter((item: any) => item.trigger !== 'hover')\n          .map((animation: any) => ({\n            ...animation,\n            elementId: this.block.id,\n          }))\n      );\n    }\n  }\n\n  // <!-- Builder Blocks --> in comments hmm\n  getElement(index = 0, state = this.privateState.state): React.ReactNode {\n    const { child, fieldName } = this.props;\n    const block = this.block;\n    let TagName: string | typeof Link = (block.tagName || 'div').toLowerCase();\n\n    if (TagName === 'template') {\n      const html = block.children\n        ? block.children.map(item => blockToHtmlString(item)).join(' ')\n        : '';\n      console.debug('template html', html);\n      return (\n        // React has an undesired behavior (for us) for template tags, so we must\n        // turn the contents into a string\n        <template\n          {...block.properties}\n          dangerouslySetInnerHTML={{\n            __html: html,\n          }}\n        />\n      );\n    }\n\n    let InnerComponent: any;\n    const componentName =\n      block.component && (block.component.name || (block.component as any).component);\n    let componentInfo: Component | null = null;\n    if (block.component && !(block.component as any).class) {\n      if (block.component && block.component.tag) {\n        InnerComponent = block.component.tag;\n      } else {\n        componentInfo = Builder.components.find(item => item.name === componentName) || null;\n        if (componentInfo && componentInfo.class) {\n          InnerComponent = componentInfo.class;\n        } else if (componentInfo && componentInfo.tag) {\n          InnerComponent = componentInfo.tag;\n        }\n      }\n    }\n\n    const TextTag: any = 'span';\n\n    let options: any = {\n      // Attributes?\n      ...block.properties,\n      style: {}, // this.styles\n    };\n\n    options = {\n      ...options.properties,\n      ...options,\n    };\n\n    if (block.component) {\n      options.component = fastClone(block.component);\n    }\n\n    // Binding should be properties to href or href?\n    // Manual style editor show bindings\n    // Show if things bound in overlays hmm\n    if (block.bindings) {\n      for (const key in block.bindings) {\n        const value = this.stringToFunction(block.bindings[key]);\n        // TODO: pass block, etc\n        set(\n          options,\n          key,\n          value(state, null, block, api(state), Device, null, Builder, this.privateState.context)\n        );\n      }\n    }\n\n    if (options.hide) {\n      return null;\n    } else {\n      delete options.hide;\n    }\n    // TODO: UI for this\n    if (('show' in options || (block.bindings && block.bindings.show)) && !options.show) {\n      return null;\n    } else {\n      delete options.show;\n    }\n\n    if (block.actions) {\n      for (const key in block.actions) {\n        const value = block.actions[key];\n        options['on' + capitalize(key)] = (event: any) => {\n          let useState = state;\n          if (typeof Proxy !== 'undefined') {\n            useState = new Proxy(state, {\n              set: (obj, prop, value) => {\n                obj[prop] = value;\n                this.privateState.rootState[prop] = value;\n                return true;\n              },\n            });\n          }\n          const fn = this.stringToFunction(value, false);\n          // TODO: only one root instance of this, don't rewrap every time...\n          return fn(\n            useState,\n            event,\n            this.block,\n            builder,\n            Device,\n            this.privateState.update,\n            Builder,\n            this.privateState.context\n          );\n        };\n      }\n    }\n\n    const innerComponentProperties = (options.component || options.options) && {\n      ...options.options,\n      ...(options.component.options || options.component.data),\n    };\n\n    const isVoid = voidElements.has(TagName);\n\n    const noWrap = componentInfo && (componentInfo.fragment || componentInfo.noWrap);\n\n    const styleStr =\n      options.attr?.style || (typeof options.style === 'string' ? options.style : '') || '';\n\n    if (typeof styleStr === 'string') {\n      if (typeof options.style !== 'object') {\n        options.style = {};\n      }\n\n      const styleSplit = styleStr.split(';');\n      for (const pair of styleSplit) {\n        const stylePieces = pair.split(':');\n        if (!stylePieces.length) {\n          return;\n        }\n\n        let [key, value] = stylePieces;\n\n        if (stylePieces.length > 2) {\n          value = stylePieces.slice(1).join(':');\n        }\n\n        options.style[kebabCaseToCamelCase(key)] = value;\n      }\n    }\n\n    const finalOptions: { [key: string]: string } = {\n      ...omit(options, ['class', 'component', 'attr']),\n      [typeof TagName === 'string' && !TagName.includes('-') ? 'className' : 'class']:\n        `builder-block ${this.id}${block.class ? ` ${block.class}` : ''}${\n          block.component && !(['Image', 'Video', 'Banner'].indexOf(componentName) > -1)\n            ? ` builder-has-component`\n            : ''\n        }` +\n        (options.class ? ' ' + options.class : '') +\n        (Builder.isEditing && this.privateState.state._spacer?.parent === block.id\n          ? ' builder-spacer-parent'\n          : ''),\n      key: this.id + index,\n      'builder-id': this.id,\n      // ...(state && state.$index && typeof state.$index === 'number'\n      //   ? {\n      // TODO: ONLY include on repeat!\n      // TODO: what if dymically repeated by another component like tabs... may not work.\n      // need function to provide that right\n      ...(index !== 0 && {\n        'builder-index': index, // String(state.$index)\n      }),\n      //   }\n      // : null)\n    };\n\n    // tslint:disable-next-line:comment-format\n    ///REACT15ONLY finalOptions.className = finalOptions.class\n\n    if (Builder.isIframe) {\n      // TODO: removed bc JS can add styles inline too?\n      (finalOptions as any)['builder-inline-styles'] = !(options.attr && options.attr.style)\n        ? ''\n        : Object.keys(options.style).reduce(\n            (memo, key) => (memo ? `${memo};` : '') + `${cssCase(key)}:${options.style[key]};`,\n            ''\n          );\n    }\n\n    if (\n      (((finalOptions as any).properties && (finalOptions as any).properties.href) ||\n        (finalOptions as any).href) &&\n      TagName === 'div'\n    ) {\n      TagName = 'a';\n    }\n\n    if (TagName === 'a') {\n      TagName = Link;\n    }\n    // const css = this.css\n\n    // const styleTag = css.trim() && (\n    //   <style className=\"builder-style\">\n    //     {(InnerComponent && !isBlock ? `.${this.id} > * { height: 100%; width: 100%; }` : '') +\n    //       this.css}\n    //   </style>\n    // )\n\n    const children = block.children || finalOptions.children || [];\n\n    // TODO: test it out\n    return (\n      <React.Fragment>\n        {/* <InsertSpacer id={block.id!} position=\"before\" /> */}\n        <ClassNames>\n          {({ css, cx }) => {\n            if (!this.props.emailMode) {\n              const addClass = ' ' + css(this.emotionCss);\n              if (finalOptions.class) {\n                finalOptions.class += addClass;\n              }\n              if (finalOptions.className) {\n                finalOptions.className += addClass;\n              }\n            }\n\n            return (\n              <BuilderAsyncRequestsContext.Consumer>\n                {value => {\n                  this._asyncRequests = value && value.requests;\n                  this._errors = value && value.errors;\n                  this._logs = value && value.logs;\n                  return isVoid ? (\n                    <TagName {...finalOptions} />\n                  ) : InnerComponent && (noWrap || this.props.emailMode) ? (\n                    // TODO: pass the class to be easier\n                    // TODO: acceptsChildren option?\n                    <InnerComponent\n                      // Final options maaay be wrong here hm\n                      {...innerComponentProperties}\n                      // should really call this builderAttributes bc people can name a\n                      // componet input \"attributes\"\n                      attributes={finalOptions}\n                      builderBlock={block}\n                      builderState={this.privateState}\n                    />\n                  ) : (\n                    <TagName {...(finalOptions as any)}>\n                      {InnerComponent && (\n                        <InnerComponent\n                          builderState={this.privateState}\n                          builderBlock={block}\n                          {...innerComponentProperties}\n                        />\n                      )}\n                      {(block as any).text || options.text\n                        ? options.text\n                        : !InnerComponent && children && Array.isArray(children) && children.length\n                        ? children.map((block: ElementType, index: number) => (\n                            <BuilderBlock\n                              key={((this.id as string) || '') + index}\n                              block={block}\n                              index={index}\n                              size={this.props.size}\n                              fieldName={this.props.fieldName}\n                              child={this.props.child}\n                              emailMode={this.props.emailMode}\n                            />\n                          ))\n                        : null}\n                    </TagName>\n                  );\n                }}\n              </BuilderAsyncRequestsContext.Consumer>\n            );\n          }}\n        </ClassNames>\n        {/* <InsertSpacer id={block.id!} position=\"after\" /> */}\n      </React.Fragment>\n    );\n  }\n\n  get id() {\n    const { block } = this;\n    if (!block.id!.startsWith('builder')) {\n      return 'builder-' + block.id;\n    }\n    return block.id!;\n  }\n\n  contents(state: BuilderBlockState) {\n    const block = this.block;\n\n    // this.setState(state);\n    this.privateState = state;\n\n    if (block.repeat && block.repeat.collection) {\n      const collectionPath = block.repeat.collection;\n      const collectionName = last((collectionPath || '').trim().split('(')[0].trim().split('.'));\n      const itemName = block.repeat.itemName || (collectionName ? collectionName + 'Item' : 'item');\n      const array = this.stringToFunction(collectionPath)(\n        state.state,\n        null,\n        block,\n        api(state),\n        Device,\n        null,\n        Builder,\n        this.privateState.context\n      );\n      if (Array.isArray(array)) {\n        return array.map((data, index) => {\n          // TODO: Builder state produce the data\n          const childState = {\n            ...state.state,\n            $index: index,\n            $item: data,\n            [itemName]: data,\n            [`$${itemName}Index`]: index,\n          };\n\n          return (\n            <BuilderStoreContext.Provider\n              key={index}\n              value={{ ...state, state: childState } as any}\n            >\n              {this.getElement(index, childState)}\n            </BuilderStoreContext.Provider>\n          );\n        });\n      }\n      return null;\n    }\n\n    return this.getElement();\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <span\n          css={{\n            display: 'inline-block',\n            padding: 5,\n            color: '#999',\n            fontSize: 11,\n            fontStyle: 'italic',\n          }}\n        >\n          Builder block error :( Check console for details\n        </span>\n      );\n    }\n    return (\n      <BuilderStoreContext.Consumer>{value => this.contents(value)}</BuilderStoreContext.Consumer>\n    );\n  }\n}\n","/** @jsx jsx */\nimport { jsx } from '@emotion/core';\nimport React from 'react';\nimport { Builder } from '@builder.io/sdk';\nimport { BuilderBlock } from './builder-block.component';\n// TODO: fetch these for user and send them with same response like graphql\nimport { Size } from '../constants/device-sizes.constant';\n\nexport interface BuilderBlocksProps {\n  fieldName?: string;\n  // TODO: block type (ElementType[])\n  blocks?: any[] | React.ReactNode;\n  child?: boolean;\n  // TODO: use new react context for this to pass window size all the way down\n  size?: Size;\n  style?: React.CSSProperties;\n  parentElementId?: string;\n  parent?: any;\n  dataPath?: string;\n  className?: string;\n  emailMode?: boolean;\n}\n\ninterface BuilderBlocksState {\n  // width: number\n}\n\n// TODO: options to set direciotn\nexport class BuilderBlocks extends React.Component<BuilderBlocksProps, BuilderBlocksState> {\n  get isRoot() {\n    return !this.props.child;\n  }\n\n  get noBlocks() {\n    const { blocks } = this.props;\n    return !(blocks && (blocks as any).length); // TODO: allow react nodes\n  }\n  get path() {\n    const pathPrefix = 'component.options.';\n    let path = this.props.dataPath || '';\n    const thisPrefix = 'this.';\n    if (path.trim()) {\n      if (path.startsWith(thisPrefix)) {\n        path = path.replace(thisPrefix, '');\n      } else if (!path.startsWith(pathPrefix)) {\n        path = pathPrefix + path;\n      }\n    }\n    return path;\n  }\n\n  get parentId() {\n    if (this.props.parentElementId) {\n      return this.props.parentElementId;\n    }\n    return this.props.parent && this.props.parent.id;\n  }\n\n  onClickEmptyBlocks = () => {\n    if (Builder.isIframe && this.noBlocks) {\n      window.parent?.postMessage(\n        {\n          type: 'builder.clickEmptyBlocks',\n          data: {\n            parentElementId: this.parentId,\n            dataPath: this.path,\n          },\n        },\n        '*'\n      );\n    }\n  };\n\n  // <!-- Builder Blocks --> in comments hmm\n  render() {\n    const { blocks } = this.props;\n\n    const TagName = this.props.emailMode ? 'span' : 'div';\n\n    // TODO: how deep check this automatically for mobx... hmmm optional / peer dependency?\n    return (\n      // TODO: component <Stack direction=\"vertical\">\n      // TODO: react.fragment instead?\n      <TagName\n        className={\n          'builder-blocks' +\n          (this.noBlocks ? ' no-blocks' : '') +\n          (this.props.child ? ' builder-blocks-child' : '') +\n          (this.props.className ? ' ' + this.props.className : '')\n        }\n        builder-type=\"blocks\"\n        // TODO: only fi in iframe?\n        builder-path={Builder.isIframe ? this.path : undefined}\n        css={{\n          ...(!this.props.emailMode && {\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'stretch',\n          }),\n          ...this.props.style,\n        }}\n        onClick={() => {\n          if (this.noBlocks) {\n            this.onClickEmptyBlocks();\n          }\n        }}\n      >\n        {/* TODO: if is react node (for react compatibility) render it */}\n        {/* TODO: maybe don't do this to preserve blocks always editable */}\n        {(blocks &&\n          Array.isArray(blocks) &&\n          (blocks as any[]).map((block, index) =>\n            block && block['@type'] === '@builder.io/sdk:Element' ? (\n              <BuilderBlock\n                key={block.id}\n                block={block}\n                index={index}\n                fieldName={this.props.fieldName}\n                child={this.props.child}\n                emailMode={this.props.emailMode}\n              />\n            ) : (\n              block\n            )\n          )) ||\n          blocks}\n      </TagName>\n    );\n  }\n}\n","import React from 'react';\n\nexport const NoWrap = (props: React.ComponentPropsWithoutRef<any>) => props.children;\n","import * as React from 'react';\nimport { builder, Builder, BuilderContent, BuilderContentVariation } from '@builder.io/sdk';\n\nfunction getData(content: BuilderContentVariation) {\n  if (typeof content?.data === 'undefined') {\n    return undefined;\n  }\n\n  const newData: any = {\n    ...content.data,\n    blocks: content.data.blocks || JSON.parse(content.data.blocksString),\n  };\n\n  delete newData.blocksString;\n  return newData;\n}\n\nconst variantsScript = (variantsString: string, contentId: string) =>\n  `\n(function() {\n  if (window.builderNoTrack) {\n    return;\n  }\n\n  var variants = ${variantsString};\n  function removeVariants() {\n    variants.forEach((template) => {\n      document.querySelector('template[data-template-variant-id=\"' + template.id + '\"]').remove();\n    });\n  }\n\n  if (typeof document.createElement(\"template\").content === 'undefined') {\n    removeVariants();\n    return ;\n  }\n\n  function setCookie(name,value,days) {\n    var expires = \"\";\n    if (days) {\n        var date = new Date();\n        date.setTime(date.getTime() + (days*24*60*60*1000));\n        expires = \"; expires=\" + date.toUTCString();\n    }\n    document.cookie = name + \"=\" + (value || \"\")  + expires + \"; path=/\" + \"; Secure; SameSite=None\";\n  }\n\n  function getCookie(name) {\n    var nameEQ = name + \"=\";\n    var ca = document.cookie.split(';');\n    for(var i=0;i < ca.length;i++) {\n        var c = ca[i];\n        while (c.charAt(0)==' ') c = c.substring(1,c.length);\n        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);\n    }\n    return null;\n  }\n  var cookieName = 'builder.tests.${contentId}';\n  var variantInCookie = getCookie(cookieName);\n  var availableIDs = variants.map(function(vr) { return vr.id }).concat('${contentId}');\n  var variantId;\n  if (availableIDs.indexOf(variantInCookie) > -1) {\n    variantId = variantInCookie;\n  }\n  if (!variantId) {\n    var n = 0;\n    var set = false;\n    var random = Math.random();\n    for (var i = 0; i < variants.length; i++) {\n      var variant = variants[i];\n      var testRatio = variant.testRatio;\n      n += testRatio;\n      if (random < n) {\n        setCookie(cookieName, variant.id);\n        variantId = variant.id;\n        break;\n      }\n    }\n    if (!variantId) {\n      variantId = \"${contentId}\";\n      setCookie(cookieName, \"${contentId}\");\n    }\n  }\n  if (variantId && variantId !== \"${contentId}\") {\n    var winningTemplate = document.querySelector('template[data-template-variant-id=\"' + variantId + '\"]');\n    if (winningTemplate) {\n      var parentNode = winningTemplate.parentNode;\n      var newParent = parentNode.cloneNode(false);\n      newParent.appendChild(winningTemplate.content.firstChild);\n      parentNode.parentNode.replaceChild(newParent, parentNode);\n    }\n  } else if (variants.length > 0) {\n    removeVariants();\n  }\n})()`.replace(/\\s+/g, ' ');\n\ninterface VariantsProviderProps {\n  initialContent: BuilderContent;\n  children: (variants: BuilderContent[], renderScript?: () => JSX.Element) => JSX.Element;\n}\n\nexport const VariantsProvider: React.SFC<VariantsProviderProps> = ({\n  initialContent,\n  children,\n}) => {\n  const hasTests = Boolean(Object.keys(initialContent?.variations || {}).length);\n\n  // when it's not isStatic variants are already elected by the sdk\n  if (!hasTests) return children([initialContent]);\n\n  const variants: BuilderContent[] = Object.keys(initialContent.variations!).map(id => ({\n    id,\n    ...initialContent.variations![id],\n    data: getData(initialContent.variations![id]!),\n  }));\n\n  const allVariants = [...variants, initialContent];\n  if (Builder.isServer) {\n    const variantsJson = JSON.stringify(\n      Object.keys(initialContent.variations || {}).map(item => ({\n        id: item,\n        testRatio: initialContent.variations![item]!.testRatio,\n      }))\n    );\n    const renderScript = () => (\n      <script\n        dangerouslySetInnerHTML={{\n          __html: variantsScript(variantsJson, initialContent.id!),\n        }}\n      ></script>\n    );\n\n    // render all variants on the server side\n    return <React.Fragment>{children(allVariants, renderScript)}</React.Fragment>;\n  }\n\n  const cookieName = `builder.tests.${initialContent.id}`;\n\n  let variantId = builder.getCookie(cookieName);\n\n  if (!variantId && Builder.isBrowser) {\n    let n = 0;\n    let set = false;\n    const random = Math.random();\n    for (let i = 0; i < variants.length; i++) {\n      const variant = variants[i];\n      const testRatio = variant.testRatio;\n      n += testRatio!;\n      if (random < n) {\n        builder.setCookie(cookieName, variant.id);\n        variantId = variant.id;\n        break;\n      }\n    }\n  }\n\n  if (!variantId) {\n    // render initial content when no winning variation or on the server\n    variantId = initialContent.id;\n    builder.setCookie(cookieName, variantId);\n  }\n\n  return children([allVariants.find(item => item.id === variantId)!]);\n};\n","import React from 'react';\nimport { builder, Subscription, GetContentOptions, Builder } from '@builder.io/sdk';\nimport { NoWrap } from './no-wrap';\nimport { applyPatchWithMinimalMutationChain } from '../functions/apply-patch-with-mutation';\nimport { VariantsProvider } from './variants-provider.component';\n\nexport interface BuilderContentProps<ContentType> {\n  contentLoaded?: (data: any, content: any) => void;\n  contentError?: (error: any) => void;\n  modelName: string;\n  options?: GetContentOptions;\n  children: (content: ContentType, loading?: boolean, fullData?: any) => React.ReactNode;\n  inline?: boolean;\n  dataOnly?: boolean;\n  builder?: Builder;\n  isStatic?: boolean;\n  content?: BuilderContent;\n}\n\nexport class BuilderContent<ContentType extends object = any> extends React.Component<\n  BuilderContentProps<ContentType>\n> {\n  ref: HTMLDivElement | null = null;\n\n  get builder() {\n    return this.props.builder || builder;\n  }\n\n  get renderedVairantId() {\n    const id = this.props.isStatic\n      ? this.builder.getCookie(`builder.tests.${this.data?.id}`)\n      : this.data?.variationId;\n    if (id !== null) {\n      return id;\n    }\n  }\n\n  get options() {\n    let options = {\n      ...(this.props.options || ({} as GetContentOptions)),\n    };\n    if (this.props.content && !options.initialContent?.length) {\n      options.initialContent = [this.props.content];\n    }\n\n    return options;\n  }\n\n  get data() {\n    const { data } = this.state;\n\n    return (\n      ((this.props.inline || !Builder.isBrowser || this.firstLoad) &&\n        this.options.initialContent &&\n        this.options.initialContent[0]) ||\n      data\n    );\n  }\n\n  state = {\n    loading: true,\n    data: null as any,\n    updates: 1,\n  };\n\n  onWindowMessage = (event: MessageEvent) => {\n    const message = event.data;\n    if (!message) {\n      return;\n    }\n    switch (message.type) {\n      case 'builder.patchUpdates': {\n        const { data } = message;\n        if (!(data && data.data)) {\n          break;\n        }\n        const patches = data.data[this.state.data?.id];\n        if (!(patches && patches.length)) {\n          return;\n        }\n\n        if (location.href.includes('builder.debug=true')) {\n          eval('debugger');\n        }\n        for (const patch of patches) {\n          applyPatchWithMinimalMutationChain(this.state.data, patch);\n        }\n        this.setState({\n          updates: this.state.updates + 1,\n          data: this.state.data ? { ...this.state.data } : this.state.data,\n        });\n        if (this.props.contentLoaded) {\n          this.props.contentLoaded(this.state.data.data, this.state.data);\n        }\n\n        break;\n      }\n    }\n  };\n\n  subscriptions = new Subscription();\n\n  firstLoad = true;\n  clicked = false;\n  trackedImpression = false;\n\n  intersectionObserver: IntersectionObserver | null = null;\n\n  // TODO: observe model name for changes\n  componentDidMount() {\n    // Temporary to test metrics diving in with bigquery and heatmaps\n    // this.builder.autoTrack = true;\n    // this.builder.env = 'development';\n    if (!this.props.inline || Builder.isEditing) {\n      this.subscribeToContent();\n    } else if (this.props.inline && this.options?.initialContent?.length) {\n      const contentData = this.options.initialContent[0];\n      // TODO: intersectionobserver like in subscribetocontent - reuse the logic\n      this.builder.trackImpression(contentData.id, this.renderedVairantId, undefined, {\n        content: contentData,\n      });\n    }\n\n    if (Builder.isEditing) {\n      addEventListener('message', this.onWindowMessage);\n    }\n\n    /// REACT15ONLY if (this.ref) { this.ref.setAttribute('builder-model', this.props.modelName); }\n  }\n\n  subscribeToContent() {\n    if (this.props.modelName !== '_inline') {\n      // TODO:... using targeting...? express.request hmmm\n      this.subscriptions.add(\n        builder.queueGetContent(this.props.modelName, this.options).subscribe(\n          matches => {\n            const match = matches && matches[0];\n            this.setState({\n              data: match,\n            });\n\n            if (match && this.firstLoad) {\n              // TODO: autoTrack\n              if (builder.autoTrack) {\n                let addedObserver = false;\n                if (typeof IntersectionObserver === 'function' && this.ref) {\n                  try {\n                    const observer = (this.intersectionObserver = new IntersectionObserver(\n                      (entries, observer) => {\n                        entries.forEach(entry => {\n                          // In view\n                          if (entry.intersectionRatio > 0 && !this.trackedImpression) {\n                            this.builder.trackImpression(\n                              match.id!,\n                              this.renderedVairantId,\n                              undefined,\n                              {\n                                content: this.data,\n                              }\n                            ),\n                              { content: this.data };\n                            this.trackedImpression = true;\n                            if (this.ref) {\n                              observer.unobserve(this.ref);\n                            }\n                          }\n                        });\n                      }\n                    ));\n\n                    observer.observe(this.ref);\n                    addedObserver = true;\n                  } catch (err) {\n                    console.warn('Could not bind intersection observer');\n                  }\n                }\n                if (!addedObserver) {\n                  this.trackedImpression = true;\n                  this.builder.trackImpression(match.id!, this.renderedVairantId, undefined, {\n                    content: match,\n                  });\n                }\n              }\n              this.firstLoad = false;\n            }\n            if (this.props.contentLoaded) {\n              this.props.contentLoaded(match && match.data, match);\n            }\n          },\n          error => {\n            if (this.props.contentError) {\n              this.props.contentError(error);\n            }\n          }\n        )\n      );\n    }\n  }\n\n  componentWillUnmount() {\n    if (Builder.isEditing) {\n      removeEventListener('message', this.onWindowMessage);\n    }\n\n    this.subscriptions.unsubscribe();\n    if (this.intersectionObserver && this.ref) {\n      this.intersectionObserver.unobserve(this.ref);\n    }\n  }\n\n  onClick = (reactEvent: React.MouseEvent<HTMLElement>) => {\n    // TODO: viewport scrolling tracking for impression events\n    const event = reactEvent.nativeEvent;\n\n    const content = this.data;\n    if (!content) {\n      return;\n    }\n    if (builder.autoTrack) {\n      this.builder.trackInteraction(content.id, this.renderedVairantId, this.clicked, event, {\n        content,\n      });\n    }\n    if (!this.clicked) {\n      this.clicked = true;\n    }\n  };\n\n  render() {\n    if (this.props.dataOnly) {\n      return null;\n    }\n    const { loading } = this.state;\n\n    const useData = this.data;\n    const TagName = this.props.dataOnly ? NoWrap : 'div';\n\n    if (!this.props.isStatic) {\n      return (\n        <TagName\n          {...(!this.props.dataOnly && {\n            ref: (ref: any) => (this.ref = ref),\n          })}\n          className=\"builder-content\"\n          onClick={this.onClick}\n          builder-content-id={useData?.id}\n          builder-model={this.props.modelName}\n        >\n          {this.props.children(useData?.data, this.props.inline ? false : loading, useData)}\n        </TagName>\n      );\n    }\n\n    return (\n      <VariantsProvider initialContent={useData}>\n        {(variants, renderScript) => {\n          return (\n            <React.Fragment>\n              {variants.map((content, index) => {\n                // default Variation is at the end, wrap the rest with template\n                // TODO: IE11 don't support templates\n                const Tag = index === variants.length - 1 ? React.Fragment : 'template';\n                return (\n                  <React.Fragment key={String(content?.id! + index)}>\n                    {Tag !== 'template' && renderScript?.()}\n                    <Tag\n                      key={String(content?.id! + index)}\n                      {...(Tag === 'template' && {\n                        'data-template-variant-id': content?.id,\n                      })}\n                    >\n                      <TagName\n                        {...(index === 0 &&\n                          !this.props.dataOnly && {\n                            ref: (ref: any) => (this.ref = ref),\n                          })}\n                        className=\"builder-content\"\n                        onClick={this.onClick}\n                        builder-content-id={content?.id}\n                        builder-model={this.props.modelName}\n                      >\n                        {this.props.children(\n                          content?.data! as any,\n                          this.props.inline ? false : loading,\n                          useData\n                        )}\n                      </TagName>\n                    </Tag>\n                  </React.Fragment>\n                );\n              })}\n            </React.Fragment>\n          );\n        }}\n      </VariantsProvider>\n    );\n  }\n}\n","// Via https://github.com/sindresorhus/on-change but\n// compiled for ES5\n\n'use strict';\nObject.defineProperty(exports, '__esModule', { value: true });\n('use strict');\nvar PATH_SEPARATOR = '.';\nvar TARGET = Symbol('target');\nvar UNSUBSCRIBE = Symbol('unsubscribe');\nvar isPrimitive = function (value) {\n  return value === null || (typeof value !== 'object' && typeof value !== 'function');\n};\nvar isBuiltinWithoutMutableMethods = function (value) {\n  return value instanceof RegExp || value instanceof Number;\n};\nvar isBuiltinWithMutableMethods = function (value) {\n  return value instanceof Date;\n};\nvar concatPath = function (path, property) {\n  if (property && property.toString) {\n    if (path) {\n      path += PATH_SEPARATOR;\n    }\n    path += property.toString();\n  }\n  return path;\n};\nvar walkPath = function (path, callback) {\n  var index;\n  while (path) {\n    index = path.indexOf(PATH_SEPARATOR);\n    if (index === -1) {\n      index = path.length;\n    }\n    callback(path.slice(0, index));\n    path = path.slice(index + 1);\n  }\n};\nvar shallowClone = function (value) {\n  if (Array.isArray(value)) {\n    return value.slice();\n  }\n  return Object.assign({}, value);\n};\nvar onChange = function (object, onChange, options) {\n  if (typeof Proxy === 'undefined') {\n    // TODO: use immer? or a technique like immer to diff maybe\n    return object;\n  }\n  if (options === void 0) {\n    options = {};\n  }\n  var proxyTarget = Symbol('ProxyTarget');\n  var inApply = false;\n  var changed = false;\n  var applyPath;\n  var applyPrevious;\n  var isUnsubscribed = false;\n  var equals = options.equals || Object.is;\n  var propCache = new WeakMap();\n  var pathCache = new WeakMap();\n  var proxyCache = new WeakMap();\n  var handleChange = function (path, property, previous, value) {\n    if (isUnsubscribed) {\n      return;\n    }\n    if (!inApply) {\n      onChange(concatPath(path, property), value, previous);\n      return;\n    }\n    if (\n      inApply &&\n      applyPrevious &&\n      previous !== undefined &&\n      value !== undefined &&\n      property !== 'length'\n    ) {\n      var item_1 = applyPrevious;\n      if (path !== applyPath) {\n        path = path.replace(applyPath, '').slice(1);\n        walkPath(path, function (key) {\n          item_1[key] = shallowClone(item_1[key]);\n          item_1 = item_1[key];\n        });\n      }\n      item_1[property] = previous;\n    }\n    changed = true;\n  };\n  var getOwnPropertyDescriptor = function (target, property) {\n    var props = propCache ? propCache.get(target) : undefined;\n    if (props) {\n      return props;\n    }\n    props = new Map();\n    propCache.set(target, props);\n    var prop = props.get(property);\n    if (!prop) {\n      prop = Reflect.getOwnPropertyDescriptor(target, property);\n      props.set(property, prop);\n    }\n    return prop;\n  };\n  var invalidateCachedDescriptor = function (target, property) {\n    var props = propCache ? propCache.get(target) : undefined;\n    if (props) {\n      props.delete(property);\n    }\n  };\n  var buildProxy = function (value, path) {\n    if (isUnsubscribed) {\n      return value;\n    }\n    pathCache.set(value, path);\n    var proxy = proxyCache.get(value);\n    if (proxy === undefined) {\n      proxy = new Proxy(value, handler);\n      proxyCache.set(value, proxy);\n    }\n    return proxy;\n  };\n  var unsubscribe = function (target) {\n    isUnsubscribed = true;\n    propCache = null;\n    pathCache = null;\n    proxyCache = null;\n    return target;\n  };\n  var ignoreChange = function (property) {\n    return isUnsubscribed || (options.ignoreSymbols === true && typeof property === 'symbol');\n  };\n  var handler = {\n    get: function (target, property, receiver) {\n      if (property === proxyTarget || property === TARGET) {\n        return target;\n      }\n      if (property === UNSUBSCRIBE && pathCache.get(target) === '') {\n        return unsubscribe(target);\n      }\n      var value = Reflect.get(target, property, receiver);\n      if (\n        isPrimitive(value) ||\n        isBuiltinWithoutMutableMethods(value) ||\n        property === 'constructor' ||\n        options.isShallow === true\n      ) {\n        return value;\n      }\n      // Preserve invariants\n      var descriptor = getOwnPropertyDescriptor(target, property);\n      if (descriptor && !descriptor.configurable) {\n        if (descriptor.set && !descriptor.get) {\n          return undefined;\n        }\n        if (descriptor.writable === false) {\n          return value;\n        }\n      }\n      return buildProxy(value, concatPath(pathCache.get(target), property));\n    },\n    set: function (target, property, value, receiver) {\n      if (value && value[proxyTarget] !== undefined) {\n        value = value[proxyTarget];\n      }\n      var ignore = ignoreChange(property);\n      var previous = ignore ? null : Reflect.get(target, property, receiver);\n      var result = Reflect.set(target[proxyTarget] || target, property, value);\n      if (!ignore && !equals(previous, value)) {\n        handleChange(pathCache.get(target), property, previous, value);\n      }\n      return result;\n    },\n    defineProperty: function (target, property, descriptor) {\n      var result = Reflect.defineProperty(target, property, descriptor);\n      if (!ignoreChange(property)) {\n        invalidateCachedDescriptor(target, property);\n        handleChange(pathCache.get(target), property, undefined, descriptor.value);\n      }\n      return result;\n    },\n    deleteProperty: function (target, property) {\n      if (!Reflect.has(target, property)) {\n        return true;\n      }\n      var ignore = ignoreChange(property);\n      var previous = ignore ? null : Reflect.get(target, property);\n      var result = Reflect.deleteProperty(target, property);\n      if (!ignore) {\n        invalidateCachedDescriptor(target, property);\n        handleChange(pathCache.get(target), property, previous);\n      }\n      return result;\n    },\n    apply: function (target, thisArg, argumentsList) {\n      var compare = isBuiltinWithMutableMethods(thisArg);\n      if (compare) {\n        thisArg = thisArg[proxyTarget];\n      }\n      if (!inApply) {\n        inApply = true;\n        if (compare) {\n          applyPrevious = thisArg.valueOf();\n        }\n        if (Array.isArray(thisArg) || toString.call(thisArg) === '[object Object]') {\n          applyPrevious = shallowClone(thisArg[proxyTarget]);\n        }\n        applyPath = pathCache.get(target);\n        applyPath = applyPath.slice(0, Math.max(applyPath.lastIndexOf(PATH_SEPARATOR), 0));\n        var result = Reflect.apply(target, thisArg, argumentsList);\n        inApply = false;\n        if (changed || (compare && !equals(applyPrevious, thisArg.valueOf()))) {\n          handleChange(applyPath, '', applyPrevious, thisArg[proxyTarget] || thisArg);\n          applyPrevious = null;\n          changed = false;\n        }\n        return result;\n      }\n      return Reflect.apply(target, thisArg, argumentsList);\n    },\n  };\n  var proxy = buildProxy(object, '');\n  onChange = onChange.bind(proxy);\n  return proxy;\n};\nonChange.target = function (proxy) {\n  return proxy[TARGET] || proxy;\n};\nonChange.unsubscribe = function (proxy) {\n  return proxy[UNSUBSCRIBE] || proxy;\n};\nmodule.exports = onChange;\nexports.default = onChange;\n","import { Builder } from '@builder.io/sdk';\n\nconst nextTick = Builder.nextTick;\n\n// Plain function - e.g. const debounced = debounceNextTick(fn);\nexport function debounceNextTick(fn: (...args: any[]) => void): () => void;\n// Decorator - e.g. class Foo { @debounceNextTick myMethod() { ... } }\nexport function debounceNextTick(\n  target: any,\n  key: PropertyKey,\n  descriptor: PropertyDescriptor\n): PropertyDescriptor;\nexport function debounceNextTick(\n  target: object | ((...args: any[]) => void),\n  key?: PropertyKey,\n  descriptor?: PropertyDescriptor\n) {\n  if (typeof key === 'undefined' && typeof target === 'function') {\n    return debounceNextTickImpl(target as any);\n  }\n  return {\n    configurable: true,\n    enumerable: descriptor!.enumerable,\n    get: function getter(): any {\n      // Attach this function to the instance (not the class)\n      Object.defineProperty(this, key!, {\n        configurable: true,\n        enumerable: descriptor!.enumerable,\n        value: debounceNextTickImpl(descriptor!.value),\n      });\n\n      return (this as any)[key!];\n    },\n  } as PropertyDescriptor;\n}\n\nfunction debounceNextTickImpl(fn: (...args: any[]) => void) {\n  let args: any[] | null = null;\n  let context: any = null;\n\n  return debounced;\n\n  function debounced(this: any) {\n    const previous = args;\n    args = [].slice.call(arguments);\n    context = this;\n    if (previous !== null) return;\n    nextTick(next);\n  }\n\n  function next() {\n    fn.apply(context, args as any);\n    args = null;\n    context = null;\n  }\n}\n","export function throttle(func: Function, wait: number, options: any = {}) {\n  let context: any;\n  let args: any;\n  let result: any;\n  let timeout = null as any;\n  let previous = 0;\n  const later = function () {\n    previous = options.leading === false ? 0 : Date.now();\n    timeout = null;\n    result = func.apply(context, args);\n    if (!timeout) context = args = null;\n  };\n  return function (this: any) {\n    const now = Date.now();\n    if (!previous && options.leading === false) previous = now;\n    const remaining = wait - (now - previous);\n    context = this;\n    args = arguments;\n    if (remaining <= 0 || remaining > wait) {\n      if (timeout) {\n        clearTimeout(timeout);\n        timeout = null;\n      }\n      previous = now;\n      result = func.apply(context, args);\n      if (!timeout) context = args = null;\n    } else if (!timeout && options.trailing !== false) {\n      timeout = setTimeout(later, remaining);\n    }\n    return result;\n  };\n}\n","import React from 'react';\n\nexport const BuilderMetaContext = React.createContext({\n  emailMode: false,\n  ampMode: false,\n  isServer: false,\n});\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { BuilderContent } from './builder-content.component';\nimport { BuilderBlocks } from './builder-blocks.component';\nimport {\n  Builder,\n  GetContentOptions,\n  builder,\n  Subscription,\n  BehaviorSubject,\n  BuilderElement,\n  BuilderContent as Content,\n} from '@builder.io/sdk';\nimport { BuilderStoreContext } from '../store/builder-store';\nimport hash from 'hash-sum';\nimport onChange from '../../lib/on-change';\n\nexport { onChange };\n\nimport { sizes } from '../constants/device-sizes.constant';\nimport {\n  BuilderAsyncRequestsContext,\n  RequestOrPromise,\n  RequestInfo,\n  isRequestInfo,\n} from '../store/builder-async-requests';\nimport { Url } from 'url';\nimport { debounceNextTick } from '../functions/debonce-next-tick';\nimport { throttle } from '../functions/throttle';\nimport { safeDynamicRequire } from '../functions/safe-dynamic-require';\nimport { BuilderMetaContext } from '../store/builder-meta';\n\nconst size = (thing: object) => Object.keys(thing).length;\n\nfunction debounce(func: Function, wait: number, immediate = false) {\n  let timeout: any;\n  return function (this: any) {\n    const context = this;\n    const args = arguments;\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    }, wait);\n    if (immediate && !timeout) func.apply(context, args);\n  };\n}\n\nconst fontsLoaded = new Set();\n\nfunction pick(object: any, keys: string[]) {\n  return keys.reduce((obj, key) => {\n    if (object && object.hasOwnProperty(key)) {\n      obj[key] = object[key];\n    }\n    return obj;\n  }, {} as any);\n}\n\n// TODO: get fetch from core JS....\nconst fetch = Builder.isBrowser ? window.fetch : require('node-fetch');\n\nconst sizeMap = {\n  desktop: 'large',\n  tablet: 'medium',\n  mobile: 'small',\n};\n\nfunction decorator(fn: Function) {\n  return function argReceiver(...fnArgs: any[]) {\n    // Check if the decorator is being called without arguments (ex `@foo methodName() {}`)\n    if (fnArgs.length === 3) {\n      const [target, key, descriptor] = fnArgs;\n      if (descriptor && (descriptor.value || descriptor.get)) {\n        fnArgs = [];\n        return descriptorChecker(target, key, descriptor);\n      }\n    }\n\n    return descriptorChecker;\n\n    // descriptorChecker determines whether a method or getter is being decorated\n    // and replaces the appropriate key with the decorated function.\n    function descriptorChecker(target: any, key: any, descriptor: any) {\n      const descriptorKey = descriptor.value ? 'value' : 'get';\n      return {\n        ...descriptor,\n        [descriptorKey]: fn(descriptor[descriptorKey], ...fnArgs),\n      };\n    }\n  };\n}\n\nconst Throttle = decorator(throttle);\n\nconst fetchCache: { [key: string]: any } = {};\n\nexport interface BuilderPageProps {\n  modelName?: string;\n  model?: string;\n  name?: string;\n  data?: any;\n  builder?: Builder;\n  entry?: string;\n  apiKey?: string;\n  options?: GetContentOptions;\n  contentLoaded?: (data: any, content: any) => void;\n  renderLink?: (props: React.AnchorHTMLAttributes<any>) => React.ReactNode;\n  contentError?: (error: any) => void;\n  content?: Content;\n  location?: Location | Url;\n  onStateChange?: (newData: any) => void;\n  noAsync?: boolean;\n  emailMode?: boolean;\n  ampMode?: boolean;\n  inlineContent?: boolean;\n  builderBlock?: BuilderElement;\n  dataOnly?: boolean;\n  hydrate?: boolean;\n  // TODO: support default values in init\n  isStatic?: boolean;\n  context?: any;\n  url?: string;\n}\n\nexport interface BuilderPageState {\n  state: any;\n  update: (state: any) => any;\n  updates: number;\n  context: any;\n  key: number;\n}\n\nconst tryEval = (str?: string, data: any = {}, errors?: Error[]): any => {\n  const value = str;\n  if (!(typeof value === 'string' && value.trim())) {\n    return;\n  }\n  const useReturn = !(value.includes(';') || value.includes(' return '));\n  let fn: Function = () => {\n    /* Intentionally empty */\n  };\n  try {\n    if (Builder.isBrowser) {\n      // tslint:disable-next-line:no-function-constructor-with-string-args\n      // TODO: VM in node......\n      fn = new Function(\n        'state',\n        // TODO: remove the with () {} - make a page v3 that doesn't use this\n        `var rootState = state;\n        if (typeof Proxy !== 'undefined') {\n          rootState = new Proxy(rootState, {\n            set: function () {\n              return false;\n            },\n            get: function (target, key) {\n              if (key === 'state') {\n                return state;\n              }\n              return target[key]\n            }\n          });\n        }\n        with (rootState) {\n          ${useReturn ? `return (${str});` : str};\n        }`\n      );\n    }\n  } catch (error) {\n    if (Builder.isBrowser) {\n      console.warn('Could not compile javascript', error);\n    } else {\n      // Add to req.options.errors to return to client\n    }\n  }\n  try {\n    if (Builder.isBrowser) {\n      return fn(data || {});\n    } else {\n      // Below is a hack to get certain code to *only* load in the server build, to not screw with\n      // browser bundler's like rollup and webpack. Our rollup plugin strips these comments only\n      // for the server build\n      // tslint:disable:comment-format\n      const { VM } = safeDynamicRequire('vm2');\n      return new VM({\n        sandbox: {\n          ...data,\n          ...{ state: data },\n        },\n        // TODO: convert reutrn to module.exports on server\n      }).run(value.replace(/(^|;)return /, '$1'));\n      // tslint:enable:comment-format\n    }\n  } catch (error) {\n    if (errors) {\n      errors.push(error);\n    }\n\n    if (Builder.isBrowser) {\n      console.warn('Builder custom code error:', error.message, 'in', str, error.stack);\n    } else {\n      if (process.env.DEBUG) {\n        console.debug('Builder custom code error:', error.message, 'in', str, error.stack);\n      }\n      // Add to req.options.errors to return to client\n    }\n  }\n\n  return;\n};\n\nfunction searchToObject(location: Location | Url) {\n  const pairs = (location.search || '').substring(1).split('&');\n  const obj: { [key: string]: string } = {};\n\n  for (const i in pairs) {\n    if (!(pairs[i] && typeof pairs[i] === 'string')) {\n      continue;\n    }\n    const pair = pairs[i].split('=');\n    obj[decodeURIComponent(pair[0])] = decodeURIComponent(pair[1]);\n  }\n\n  return obj;\n}\n\nexport class BuilderPage extends React.Component<BuilderPageProps, BuilderPageState> {\n  subscriptions: Subscription = new Subscription();\n  // TODO: don't trigger initial one?\n  onStateChange = new BehaviorSubject<any>(null);\n  asServer = Builder.isServer;\n\n  contentRef: BuilderContent | null = null;\n\n  styleRef: HTMLStyleElement | null = null;\n\n  rootState = Builder.isServer ? {} : onChange({}, () => this.updateState());\n\n  lastJsCode = '';\n  lastHttpRequests: { [key: string]: string | undefined } = {};\n  httpSubscriptionPerKey: { [key: string]: Subscription | undefined } = {};\n\n  ref: HTMLElement | null = null;\n\n  get name(): string | undefined {\n    return this.props.model || this.props.modelName || this.props.name; // || this.props.model\n  }\n\n  private _asyncRequests?: RequestOrPromise[];\n  private _errors?: Error[];\n  private _logs?: string[];\n\n  get element() {\n    return this.ref;\n  }\n\n  constructor(props: BuilderPageProps) {\n    super(props);\n\n    // TODO: pass this all the way down - symbols, etc\n    // this.asServer = Boolean(props.hydrate && Builder.isBrowser)\n\n    this.state = {\n      // TODO: should change if this prop changes\n      context: props.context || {},\n      state: Object.assign(this.rootState, {\n        ...(this.props.content && this.props.content.data && this.props.content.data.state),\n        isBrowser: Builder.isBrowser, // !this.asServer,\n        isServer: !Builder.isBrowser, // this.asServer,\n        _hydrate: props.hydrate,\n        location: this.locationState,\n        deviceSize: this.deviceSizeState,\n        // TODO: will user attributes be ready here?\n        device: this.device,\n        ...this.getHtmlData(),\n        ...props.data,\n      }),\n      updates: 0,\n      key: 0,\n      update: this.updateState,\n    };\n\n    if (Builder.isBrowser) {\n      const key = this.props.apiKey;\n      if (key && key !== this.builder.apiKey) {\n        this.builder.apiKey = key;\n      }\n\n      if (this.props.content) {\n        // Sometimes with graphql we get the content as `content.content`\n        const content = (this.props.content as any).content || this.props.content;\n        this.onContentLoaded(content?.data, content);\n      }\n    }\n  }\n\n  get builder() {\n    return this.props.builder || builder;\n  }\n\n  getHtmlData() {\n    const id = (this.props.content && this.props.content.id) || this.props.entry;\n    const script =\n      id &&\n      Builder.isBrowser &&\n      document.querySelector(\n        `script[data-builder-json=\"${id}\"],script[data-builder-state=\"${id}\"]`\n      );\n    if (script) {\n      try {\n        const json = JSON.parse((script as HTMLElement).innerText);\n        return json;\n      } catch (err) {\n        console.warn(\n          'Could not parse Builder.io HTML data transfer',\n          err,\n          (script as HTMLElement).innerText\n        );\n      }\n    }\n    return {};\n  }\n\n  // TODO: pass down with context\n  get device() {\n    return this.builder.getUserAttributes().device || 'desktop';\n  }\n\n  get locationState() {\n    return {\n      // TODO: handle this correctly on the server. Pass in with CONTEXT\n      ...pick(this.location, ['pathname', 'hostname', 'search', 'host']),\n      path: (this.location.pathname && this.location.pathname.split('/').slice(1)) || '',\n      query: searchToObject(this.location),\n    };\n  }\n\n  // TODO: trigger state change on screen size change\n  get deviceSizeState() {\n    // TODO: use context to pass this down on server\n    return Builder.isBrowser\n      ? sizes.getSizeForWidth(window.innerWidth)\n      : sizeMap[this.device] || 'large';\n  }\n\n  messageListener = (event: MessageEvent) => {\n    const info = event.data;\n    switch (info.type) {\n      case 'builder.updateSpacer': {\n        const data = info.data;\n        const currentSpacer = this.rootState._spacer;\n        this.updateState(state => {\n          state._spacer = data;\n        });\n        break;\n      }\n      case 'builder.resetState': {\n        const { state, model } = info.data;\n        if (model === this.name) {\n          for (const key in this.rootState) {\n            // TODO: support nested functions (somehow)\n            if (typeof this.rootState[key] !== 'function') {\n              delete this.rootState[key];\n            }\n          }\n          Object.assign(this.rootState, state);\n          this.setState({\n            ...this.state,\n            state: this.rootState,\n            updates: ((this.state && this.state.updates) || 0) + 1,\n          });\n        }\n        break;\n      }\n      case 'builder.resetSymbolState': {\n        const { state, model, id } = info.data.state;\n        if (this.props.builderBlock && this.props.builderBlock === id) {\n          for (const key in this.rootState) {\n            delete this.rootState[key];\n          }\n          Object.assign(this.rootState, state);\n          this.setState({\n            ...this.state,\n            state: this.rootState,\n            updates: ((this.state && this.state.updates) || 0) + 1,\n          });\n        }\n        break;\n      }\n    }\n  };\n\n  resizeFn = () => {\n    const deviceSize = this.deviceSizeState;\n    if (deviceSize !== this.state.state.deviceSize) {\n      this.setState({\n        ...this.state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n        state: Object.assign(this.rootState, {\n          ...this.state.state,\n          deviceSize,\n        }),\n      });\n    }\n  };\n\n  resizeListener = Builder.isEditing ? throttle(this.resizeFn, 200) : debounce(this.resizeFn, 400);\n\n  static renderInto(\n    elementOrSelector: string | HTMLElement,\n    props: BuilderPageProps = {},\n    hydrate = true,\n    fresh = false\n  ) {\n    console.debug('BuilderPage.renderInto', elementOrSelector, props, hydrate, this);\n\n    if (!elementOrSelector) {\n      return;\n    }\n\n    let element: Element | null = null;\n\n    if (typeof elementOrSelector === 'string') {\n      element = document.querySelector(elementOrSelector);\n    } else {\n      if (elementOrSelector instanceof Element) {\n        element = elementOrSelector;\n      }\n    }\n\n    if (!element) {\n      return;\n    }\n\n    const exists = element.classList.contains('builder-hydrated');\n    if (exists && !fresh) {\n      console.debug('Tried to hydrate multiple times');\n      return;\n    }\n    element.classList.add('builder-hydrated');\n\n    let shouldHydrate = hydrate && element.innerHTML.includes('builder-block');\n\n    if (!element.classList.contains('builder-component')) {\n      // TODO: maybe remove any builder-api-styles...\n      const apiStyles =\n        element.querySelector('.builder-api-styles') ||\n        (element.previousElementSibling &&\n        element.previousElementSibling.matches('.builder-api-styles')\n          ? element.previousElementSibling\n          : null);\n      let keepStyles = '';\n      if (apiStyles) {\n        const html = apiStyles.innerHTML;\n        html.replace(\n          /\\/\\*start:([^\\*]+?)\\*\\/([\\s\\S]*?)\\/\\*end:([^\\*]+?)\\*\\//g,\n          (match, id, content) => {\n            let el: HTMLElement | null = null;\n            try {\n              el = document.querySelector(`[data-emotion-css=\"${id}\"]`);\n            } catch (err) {\n              console.warn(err);\n            }\n            if (el) {\n              el.innerHTML = content;\n            } else if (!Builder.isEditing) {\n              keepStyles += match;\n            }\n\n            return match;\n          }\n        );\n        // NextTick? or longer timeout?\n        Builder.nextTick(() => {\n          apiStyles.innerHTML = keepStyles;\n        });\n      }\n      const useElement = element.querySelector('.builder-component');\n      if (useElement) {\n        element = useElement;\n      } else {\n        shouldHydrate = false;\n      }\n    }\n\n    if (location.search.includes('builder.debug=true')) {\n      console.debug('hydrate', shouldHydrate, element);\n    }\n\n    let useEl = element;\n    if (!exists) {\n      const div = document.createElement('div');\n      element.insertAdjacentElement('beforebegin', div);\n      div.appendChild(element);\n      useEl = div;\n    }\n\n    if (Builder.isEditing || (Builder.isBrowser && location.search.includes('builder.preview='))) {\n      shouldHydrate = false;\n    }\n    if (shouldHydrate && element) {\n      // TODO: maybe hydrate again. Maybe...\n      const val = ReactDOM.render(<BuilderPage {...props} />, useEl, (useEl as any).builderRootRef);\n      (useEl as any).builderRootRef = val;\n      return val;\n    }\n    const val = ReactDOM.render(<BuilderPage {...props} />, useEl, (useEl as any).builderRootRef);\n    (useEl as any).builderRootRef = val;\n    return val;\n  }\n\n  mounted = false;\n\n  componentDidMount() {\n    this.mounted = true;\n    if (this.asServer) {\n      this.asServer = false;\n      this.updateState(state => {\n        state.isBrowser = true;\n        state.isServer = false;\n      });\n    }\n\n    if (Builder.isIframe) {\n      window.parent?.postMessage(\n        { type: 'builder.sdkInjected', data: { modelName: this.name } },\n        '*'\n      );\n    }\n\n    if (Builder.isBrowser) {\n      // TODO: remove event on unload\n      window.addEventListener('resize', this.resizeListener);\n      if (Builder.isEditing) {\n        window.addEventListener('message', this.messageListener);\n      }\n\n      setTimeout(() => {\n        window.dispatchEvent(\n          new CustomEvent('builder:component:load', {\n            detail: {\n              ref: this,\n            },\n          })\n        );\n      });\n    }\n  }\n\n  updateState = (fn?: (state: any) => void) => {\n    const state = this.rootState;\n    if (fn) {\n      fn(state);\n    }\n    if (this.mounted) {\n      this.setState({\n        update: this.updateState,\n        state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n      });\n    } else {\n      this.state = {\n        ...this.state,\n        update: this.updateState,\n        state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n      };\n    }\n\n    this.notifyStateChange();\n  };\n\n  @debounceNextTick\n  notifyStateChange() {\n    if (Builder.isServer) {\n      return;\n    }\n    if (!(this && this.state)) {\n      return;\n    }\n    const nextState = this.state.state;\n    // TODO: only run the below once per tick...\n    if (this.props.onStateChange) {\n      this.props.onStateChange(nextState);\n    }\n\n    if (Builder.isBrowser) {\n      window.dispatchEvent(\n        new CustomEvent('builder:component:stateChange', {\n          detail: {\n            state: nextState,\n            ref: this,\n          },\n        })\n      );\n    }\n    this.onStateChange.next(nextState);\n  }\n\n  processStateFromApi(state: { [key: string]: any }) {\n    return state; //  mapValues(state, value => tryEval(value, this.data, this._errors))\n  }\n\n  get location() {\n    return this.props.location || (Builder.isBrowser ? location : ({} as any));\n  }\n\n  getCssFromFont(font: any, data?: any) {\n    // TODO: compute what font sizes are used and only load those.......\n    const family = font.family + (font.kind && !font.kind.includes('#') ? ', ' + font.kind : '');\n    const name = family.split(',')[0];\n    const url = font.fileUrl ? font.fileUrl : font.files && font.files.regular;\n    let str = '';\n    if (url && family && name) {\n      str += `\n@font-face {\n  font-family: \"${family}\";\n  src: local(\"${name}\"), url('${url}') format('woff2');\n  font-display: fallback;\n  font-weight: 400;\n}\n        `.trim();\n    }\n\n    if (font.files) {\n      for (const weight in font.files) {\n        const isNumber = String(Number(weight)) === weight;\n        if (!isNumber) {\n          continue;\n        }\n        // TODO: maybe limit number loaded\n        const weightUrl = font.files[weight];\n        if (weightUrl && weightUrl !== url) {\n          str += `\n@font-face {\n  font-family: \"${family}\";\n  src: url('${weightUrl}') format('woff2');\n  font-display: fallback;\n  font-weight: ${weight};\n}\n          `.trim();\n        }\n      }\n    }\n    return str;\n  }\n\n  componentWillUnmount() {\n    this.unsubscribe();\n    if (Builder.isBrowser) {\n      window.removeEventListener('resize', this.resizeListener);\n      window.removeEventListener('message', this.messageListener);\n    }\n  }\n\n  getFontCss(data?: any) {\n    if (!this.builder.allowCustomFonts) {\n      return '';\n    }\n    // TODO: separate internal data from external\n    return (\n      (data?.customFonts &&\n        data.customFonts.length &&\n        data.customFonts.map((font: any) => this.getCssFromFont(font, data)).join(' ')) ||\n      ''\n    );\n  }\n\n  ensureFontsLoaded(data?: any) {\n    if (this.builder.allowCustomFonts && data?.customFonts && Array.isArray(data.customFonts)) {\n      for (const font of data.customFonts) {\n        const url = font.fileUrl ? font.fileUrl : font.files && font.files.regular;\n        if (!fontsLoaded.has(url)) {\n          const html = this.getCssFromFont(font, data);\n          fontsLoaded.add(url);\n          if (!html) {\n            continue;\n          }\n          const style = document.createElement('style');\n          style.className = 'builder-custom-font';\n          style.setAttribute('data-builder-custom-font', url);\n          style.innerHTML = html;\n          document.head.appendChild(style);\n        }\n      }\n    }\n  }\n\n  getCss(data?: any) {\n    const contentId = this.useContent?.id;\n    let cssCode = data?.cssCode || '';\n    if (contentId) {\n      // Allow using `&` in custom CSS code like @emotion\n      // E.g. `& .foobar { ... }` to scope CSS\n      // TODO: handle if '&' is within a string like `content: \"&\"`\n      cssCode = cssCode.replace(/&/g, `.builder-component-${contentId}`);\n    }\n\n    return cssCode + this.getFontCss(data);\n  }\n\n  get data() {\n    const data = {\n      ...(this.props.content && this.props.content.data?.state),\n      ...this.props.data,\n      ...this.state.state,\n    };\n    Object.assign(this.rootState, data);\n    return data;\n  }\n\n  componentDidUpdate(prevProps: BuilderPageProps) {\n    // TODO: shallow diff\n    if (this.props.data && prevProps.data !== this.props.data) {\n      this.state.update((state: any) => {\n        Object.assign(state, this.props.data);\n      });\n    }\n\n    if (Builder.isEditing) {\n      if (this.props.content && prevProps.content !== this.props.content) {\n        this.onContentLoaded(this.props.content.data, this.props.content);\n      }\n    }\n  }\n\n  // FIXME: workaround to issue with CSS extraction and then hydration\n  // (might be preact only)\n  checkStyles(data: any) {\n    if (this.styleRef) {\n      const css = this.getCss(data);\n      if (this.styleRef.innerHTML !== css) {\n        this.styleRef.innerHTML = css;\n      }\n    }\n  }\n\n  reload() {\n    this.setState({\n      key: this.state.key + 1,\n    });\n  }\n\n  get content() {\n    let { content } = this.props;\n    if (content && (content as any).content) {\n      // GraphQL workaround\n      content = {\n        ...content,\n        data: (content as any).content,\n      };\n    }\n    return content;\n  }\n\n  get useContent() {\n    return this.content || this.state.context.builderContent;\n  }\n\n  render() {\n    const content = this.content;\n\n    const dataString =\n      Builder.isBrowser && this.props.data && size(this.props.data) && hash(this.props.data);\n    let key = Builder.isEditing ? this.name : this.props.entry;\n    if (key && !Builder.isEditing && dataString && dataString.length < 300) {\n      key += ':' + dataString;\n    }\n\n    const WrapComponent = this.props.dataOnly ? React.Fragment : 'div';\n\n    const contentId = this.useContent?.id;\n\n    return (\n      // TODO: data attributes for model, id, etc?\n      <WrapComponent\n        className={`builder-component ${contentId ? `builder-component-${contentId}` : ''}`}\n        data-name={this.name}\n        data-source={`Rendered by Builder.io on ${new Date().toUTCString()}`}\n        key={this.state.key}\n        ref={ref => (this.ref = ref)}\n      >\n        <BuilderMetaContext.Consumer>\n          {value => (\n            <BuilderMetaContext.Provider\n              value={\n                typeof this.props.ampMode === 'boolean'\n                  ? {\n                      ...value,\n                      ampMode: this.props.ampMode,\n                    }\n                  : value\n              }\n            >\n              <BuilderAsyncRequestsContext.Consumer>\n                {value => {\n                  this._asyncRequests = value && value.requests;\n                  this._errors = value && value.errors;\n                  this._logs = value && value.logs;\n\n                  return (\n                    <BuilderContent\n                      isStatic={this.props.isStatic || Builder.isStatic}\n                      key={\n                        this.props.content?.id ||\n                        ('content' in this.props ? 'null-content-prop' : 'no-content-prop')\n                      }\n                      builder={this.builder}\n                      ref={ref => (this.contentRef = ref)}\n                      // TODO: pass entry in\n                      contentLoaded={(data, content) => this.onContentLoaded(data, content)}\n                      options={{\n                        key,\n                        entry: this.props.entry,\n                        ...(content && { initialContent: [content] }),\n                        ...(!content && 'content' in this.props && { initialContent: [] }),\n                        ...(this.props.url && { url: this.props.url }),\n                        ...this.props.options,\n                      }}\n                      inline={\n                        this.props.inlineContent || (!Builder.isEditing && 'content' in this.props)\n                      }\n                      contentError={this.props.contentError}\n                      modelName={this.name || 'page'}\n                    >\n                      {(data, loading, fullData) => {\n                        if (this.props.dataOnly) {\n                          return null;\n                        }\n\n                        if (fullData && fullData.id) {\n                          this.state.context.builderContent = fullData;\n                        }\n                        if (Builder.isBrowser) {\n                          Builder.nextTick(() => {\n                            this.checkStyles(data);\n                          });\n                        }\n                        // TODO: loading option - maybe that is what the children is or component prop\n                        // TODO: get rid of all these wrapper divs\n                        return data ? (\n                          <div\n                            data-builder-component={this.name}\n                            data-builder-content-id={fullData.id}\n                            data-builder-variation-id={\n                              fullData.testVariationId || fullData.variationId || fullData.id\n                            }\n                          >\n                            {this.getCss(data) && (\n                              <style\n                                ref={ref => (this.styleRef = ref)}\n                                className=\"builder-custom-styles\"\n                                dangerouslySetInnerHTML={{\n                                  __html: this.getCss(data),\n                                }}\n                              />\n                            )}\n                            <BuilderStoreContext.Provider\n                              value={{\n                                ...this.state,\n                                rootState: this.rootState,\n                                state: this.data,\n                                content: fullData,\n                                renderLink: this.props.renderLink,\n                              }}\n                            >\n                              <BuilderBlocks\n                                key={String(!!data?.blocks?.length)}\n                                emailMode={this.props.emailMode}\n                                fieldName=\"blocks\"\n                                blocks={data.blocks}\n                              />\n                            </BuilderStoreContext.Provider>\n                          </div>\n                        ) : loading ? (\n                          <div data-builder-component={this.name} className=\"builder-loading\">\n                            {this.props.children}\n                          </div>\n                        ) : (\n                          <div data-builder-component={this.name} className=\"builder-no-content\" />\n                        );\n                      }}\n                    </BuilderContent>\n                  );\n                }}\n              </BuilderAsyncRequestsContext.Consumer>\n            </BuilderMetaContext.Provider>\n          )}\n        </BuilderMetaContext.Consumer>\n      </WrapComponent>\n    );\n  }\n\n  evalExpression(expression: string) {\n    const { data } = this;\n    return expression.replace(/{{([^}]+)}}/g, (match, group) => tryEval(group, data, this._errors));\n  }\n\n  // TODO: customizable hm\n  @Throttle(100, { leading: true, trailing: true })\n  throttledHandleRequest(propertyName: string, url: string) {\n    return this.handleRequest(propertyName, url);\n  }\n\n  async handleRequest(propertyName: string, url: string) {\n    // TODO: Builder.isEditing = just checks if iframe and parent page is this.builder.io or localhost:1234\n    if (Builder.isIframe && fetchCache[url]) {\n      this.updateState(ctx => {\n        ctx[propertyName] = fetchCache[url];\n      });\n      return fetchCache[url];\n    }\n    const request = async () => {\n      const requestStart = Date.now();\n      if (!Builder.isBrowser) {\n        console.time('Fetch ' + url);\n      }\n      let json: any;\n      try {\n        const result = await fetch(url);\n        json = await result.json();\n      } catch (err) {\n        if (this._errors) {\n          this._errors.push(err);\n        }\n        if (this._logs) {\n          this._logs.push(`Fetch to ${url} errored in ${Date.now() - requestStart}ms`);\n        }\n        return;\n      } finally {\n        if (!Builder.isBrowser) {\n          console.timeEnd('Fetch ' + url);\n          if (this._logs) {\n            this._logs.push(`Fetched ${url} in ${Date.now() - requestStart}ms`);\n          }\n        }\n      }\n\n      if (json) {\n        if (Builder.isIframe) {\n          fetchCache[url] = json;\n        }\n        // TODO: debounce next tick all of these when there are a bunch\n        this.updateState(ctx => {\n          ctx[propertyName] = json;\n        });\n      }\n\n      return json;\n    };\n    const existing =\n      this._asyncRequests &&\n      (this._asyncRequests.find(\n        req => isRequestInfo(req) && req.url === url\n      ) as RequestInfo | null);\n    if (existing) {\n      const promise = existing.promise;\n      promise.then(json => {\n        if (json) {\n          this.updateState(ctx => {\n            ctx[propertyName] = json;\n          });\n        }\n      });\n      return promise;\n    }\n    const promise = request();\n    Builder.nextTick(() => {\n      if (this._asyncRequests) {\n        this._asyncRequests.push(promise);\n      }\n    });\n    return promise;\n  }\n\n  unsubscribe() {\n    if (this.subscriptions) {\n      this.subscriptions.unsubscribe();\n      this.subscriptions = new Subscription();\n    }\n  }\n\n  handleBuilderRequest(propertyName: string, optionsString: string) {\n    const options = tryEval(optionsString, this.data, this._errors);\n    // TODO: this will screw up for multiple bits of data\n    if (this.subscriptions) {\n      this.unsubscribe();\n    }\n    // TODO: don't unsubscribe and resubscribe every time data changes, will make a TON of requests if that's the case when editing...\n    // I guess will be cached then\n    if (options) {\n      // TODO: unsubscribe on destroy\n      this.subscriptions.add(\n        this.builder.queueGetContent(options.model, options).subscribe(matches => {\n          if (matches) {\n            this.updateState(ctx => {\n              ctx[propertyName] = matches;\n            });\n          }\n        })\n      );\n    }\n  }\n\n  onContentLoaded = (data: any, content: any) => {\n    if (this.name === 'page' && Builder.isBrowser) {\n      if (data) {\n        const { title, pageTitle, description, pageDescription } = data;\n\n        if (title || pageTitle) {\n          document.title = title || pageTitle;\n        }\n\n        if (description || pageDescription) {\n          let descriptionTag = document.querySelector('meta[name=\"description\"]');\n\n          if (!descriptionTag) {\n            descriptionTag = document.createElement('meta');\n            descriptionTag.setAttribute('name', 'description');\n            document.head.appendChild(descriptionTag);\n          }\n\n          descriptionTag.setAttribute('content', description || pageDescription);\n        }\n      }\n    }\n\n    if (Builder.isEditing) {\n      this.notifyStateChange();\n    }\n\n    // Unsubscribe all? TODO: maybe don't continuous fire when editing.....\n    if (this.props.contentLoaded) {\n      this.props.contentLoaded(data, content);\n    }\n\n    if (data && data.inputs && Array.isArray(data.inputs) && data.inputs.length) {\n      if (!data.state) {\n        data.state = {};\n      }\n\n      // Maybe...\n      // if (data.context) {\n      //   Object.assign(this.state.context, data.context)\n      // }\n      // TODO: may not want this... or make sure anything overriden\n      // explitily sets to null\n      data.inputs.forEach((input: any) => {\n        if (input) {\n          if (\n            input.name &&\n            input.defaultValue !== undefined &&\n            data.state[input.name] === undefined\n          ) {\n            data.state[input.name] = input.defaultValue;\n          }\n        }\n      });\n    }\n\n    if (data && data.state) {\n      const newState = {\n        ...this.state,\n        updates: ((this.state && this.state.updates) || 0) + 1,\n        state: Object.assign(this.rootState, {\n          ...this.state.state,\n          location: this.locationState,\n          deviceSize: this.deviceSizeState,\n          device: this.device,\n          ...data.state,\n          ...this.props.data,\n        }),\n      };\n      if (this.mounted) {\n        this.setState(newState);\n      } else {\n        this.state = newState;\n      }\n    }\n\n    // TODO: also throttle on edits maybe\n    if (data && data.jsCode && Builder.isBrowser) {\n      // Don't rerun js code when editing and not changed\n      let skip = false;\n      if (Builder.isEditing) {\n        if (this.lastJsCode === data.jsCode) {\n          skip = true;\n        } else {\n          this.lastJsCode = data.jsCode;\n        }\n      }\n\n      if (!skip) {\n        const state = this.state.state;\n\n        // TODO: real editing method\n        try {\n          const result = new Function(\n            'data',\n            'ref',\n            'state',\n            'update',\n            'element',\n            'Builder',\n            'builder',\n            'context',\n            data.jsCode\n          )(data, this, state, this.state.update, this.ref, Builder, builder, this.state.context);\n\n          // TODO: allow exports = { } syntax?\n          // TODO: do something with reuslt like view - methods, computed, actions, properties, template, etc etc\n        } catch (error) {\n          if (Builder.isBrowser) {\n            console.warn(\n              'Builder custom code error:',\n              error.message,\n              'in',\n              data.jsCode,\n              error.stack\n            );\n          } else {\n            if (process.env.DEBUG) {\n              console.debug(\n                'Builder custom code error:',\n                error.message,\n                'in',\n                data.jsCode,\n                error.stack\n              );\n            }\n            // Add to req.options.errors to return to client\n          }\n        }\n      }\n    }\n\n    if (data && data.httpRequests /* || data.builderData @DEPRECATED */ && !this.props.noAsync) {\n      // Don't rerun http requests when editing and not changed\n      // No longer needed?\n      let skip = false;\n\n      if (!skip) {\n        // TODO: another structure for this\n        for (const key in data.httpRequests) {\n          const url: string | undefined = data.httpRequests[key];\n          if (url && (!this.data[key] || Builder.isEditing)) {\n            // TODO: if Builder.isEditing and url patches https://builder.io/api/v2/content/{editingModel}\n            // Then use this.builder.get().subscribe(...)\n            if (Builder.isBrowser) {\n              const finalUrl = this.evalExpression(url);\n              if (Builder.isEditing && this.lastHttpRequests[key] === finalUrl) {\n                continue;\n              }\n              this.lastHttpRequests[key] = finalUrl;\n              const builderModelRe = /builder\\.io\\/api\\/v2\\/([^\\/\\?]+)/i;\n              const builderModelMatch = url.match(builderModelRe);\n              const model = builderModelMatch && builderModelMatch[1];\n              if (false && Builder.isEditing && model && this.builder.editingModel === model) {\n                this.throttledHandleRequest(key, finalUrl);\n                // TODO: fix this\n                // this.subscriptions.add(\n                //   this.builder.get(model).subscribe(data => {\n                //     this.state.update((state: any) => {\n                //       state[key] = data\n                //     })\n                //   })\n                // )\n              } else {\n                this.throttledHandleRequest(key, finalUrl);\n                const currentSubscription = this.httpSubscriptionPerKey[key];\n                if (currentSubscription) {\n                  currentSubscription.unsubscribe();\n                }\n\n                // TODO: fix this\n                const newSubscription = (this.httpSubscriptionPerKey[\n                  key\n                ] = this.onStateChange.subscribe(() => {\n                  const newUrl = this.evalExpression(url);\n                  if (newUrl !== finalUrl) {\n                    this.throttledHandleRequest(key, newUrl);\n                    this.lastHttpRequests[key] = newUrl;\n                  }\n                }));\n                this.subscriptions.add(newSubscription);\n              }\n            } else {\n              this.handleRequest(key, this.evalExpression(url));\n            }\n          }\n        }\n\n        // @DEPRECATED\n        // for (const key in data.builderData) {\n        //   const url = data.builderData[key]\n        //   if (url && !this.data[key]) {\n        //     this.handleBuilderRequest(key, this.evalExpression(url))\n        //   }\n        // }\n      }\n    }\n  };\n}\n","import React from 'react';\nimport { BuilderElement } from '@builder.io/sdk';\nimport { BuilderBlock } from '../components/builder-block.component';\n\n/**\n * Higher order component for passing Builder.io children as React children\n *\n * @example\n * ```tsx\n *\n *    const MyButton = props => <Button>\n *      {children}\n *    </Button>\n *\n *    const ButtonWithBuilderChildren = withChildren(MyButton)\n *\n *    Builder.registerComponent(ButtonWithBuilderChildren, {\n *      name: 'MyButton',\n *      defaultChildren: [\n *        {\n *          '@type': '@builder.io/sdk:Element'\n *        }\n *      ]\n *    })\n * ```\n */\nexport const withChildren = <P extends object>(Component: React.ComponentType<P>) => {\n  const HOC = React.forwardRef<any, React.PropsWithChildren<P> & { builderBlock?: BuilderElement }>(\n    (props, ref) => {\n      const children =\n        props.children ||\n        (props.builderBlock &&\n          props.builderBlock.children &&\n          props.builderBlock.children.map(child => <BuilderBlock key={child.id} block={child} />));\n\n      return (\n        <Component {...props} ref={ref}>\n          {children}\n        </Component>\n      );\n    }\n  );\n\n  (HOC as any).builderOptions = {\n    canHaveChildren: true,\n  };\n\n  return HOC;\n};\n","import './scripts/init-editing';\n\nimport { builder, Builder } from '@builder.io/sdk';\nexport { BuilderElement } from '@builder.io/sdk';\n\nBuilder.isReact = true;\n\nexport { BuilderBlocks } from './components/builder-blocks.component';\nexport { BuilderBlock as BuilderBlockComponent } from './components/builder-block.component';\nexport { BuilderContent } from './components/builder-content.component';\nimport { BuilderPage } from './components/builder-page.component';\nexport { BuilderStoreContext } from './store/builder-store';\nexport { BuilderMetaContext } from './store/builder-meta';\nexport { BuilderAsyncRequestsContext } from './store/builder-async-requests';\nexport { withChildren } from './functions/with-children';\n\nexport { BuilderPage };\nexport { BuilderPage as BuilderComponent };\n\nexport { stringToFunction } from './functions/string-to-function';\n\nexport { builder, Builder };\nexport default builder;\n"],"names":["window","parent","postMessage","type","data","value","supportsPatchUpdates","priorVersion","version","sizeNames","sizes","xsmall","min","default","max","small","medium","large","getWidthForSize","size","this","getSizeForWidth","width","sizeNames_1","_i","set","obj","_path","Object","path","Array","isArray","toString","match","slice","reduce","a","c","i","Math","abs","Number","length","safeDynamicRequire","Builder","isServer","eval","fnCache","api","state","builder","stringToFunction","str","expression","errors","logs","trim","cacheKey","useReturn","includes","startsWith","fn","replace","_match","group","toLowerCase","substring","isBrowser","Function","error","push","message","indexOf","console","warn","args","VM","event_1","timeout","sandbox","event","run","stack","process","env","DEBUG","debug","isPromise","thing","then","isRequestInfo","BuilderAsyncRequestsContext","React","createContext","requests","BuilderStoreContext","rootState","content","context","update","mutator","applyPatchWithMinimalMutationChain","patch","preserveRoot","op","pathArr","split","shift","newObj","objPart","isLast","property","index","splice","nextProperty","newPart","String","htmlEscape","blockToHtmlString","block","tagName","id","class","keys","properties","map","key","join","component","name","options","text","children","item","Link","props","Consumer","renderLink","camelCaseToKebabCase","g","kebabCaseToCamelCase","toUpperCase","Device","desktop","tablet","mobile","blocksMap","voidElements","Set","pick","object","hasOwnProperty","last","arr","omit","values","newObject","assign","values_1","cssCase","fastClone","JSON","parse","stringify","mapToCss","spaces","important","memo","repeat","capitalize","_this","hasError","updates","selection","setTimeout","$block","$blocks","patches","location","href","newBlock","patches_1","setState","__extends","BuilderBlock","privateState","errorInfo","_errors","_logs","nextProps","isEditing","initialAnimationStepStyles","styles","startIndex","responsiveStyles","name_1","animation","animations","firstStep","steps","stepStyles","reverse","trigger","reversedNames","self","reversedNames_1","emailMode","&.builder-block","hoverAnimation","find","transition","duration","easing","delay","transitionDelay","baseStyles","css","reversedNames_2","emailOuterSizes","outer","firstAnimation","undefined","removeEventListener","onWindowMessage","addEventListener","bindings","animator","bindAnimations","filter","elementId","InnerComponent","_d","TagName","html","jsx","dangerouslySetInnerHTML","__html","componentName","componentInfo","tag","components","style","hide","show","actions","useState","Proxy","prop","innerComponentProperties","isVoid","has","noWrap","fragment","styleStr","attr","styleSplit_1","stylePieces","finalOptions","_spacer","_a","builder-index","isIframe","Fragment","ClassNames","addClass","emotionCss","className","_asyncRequests","attributes","builderBlock","builderState","fieldName","child","collection","collectionPath","collectionName","itemName_1","itemName","array","childState","$index","$item","Provider","__assign","getElement","display","padding","color","fontSize","fontStyle","contents","Component","noBlocks","parentElementId","parentId","dataPath","BuilderBlocks","blocks","flexDirection","alignItems","onClick","onClickEmptyBlocks","NoWrap","getData","newData","blocksString","variantsScript","variantsString","contentId","VariantsProvider","initialContent","Boolean","variations","variants","allVariants","variantsJson_1","testRatio","React.createElement","React.Fragment","cookieName","variantId","getCookie","n","random","variant","setCookie","loading","contentLoaded","Subscription","reactEvent","nativeEvent","autoTrack","trackInteraction","renderedVairantId","clicked","BuilderContent","isStatic","variationId","inline","firstLoad","subscribeToContent","contentData","trackImpression","modelName","subscriptions","add","queueGetContent","subscribe","matches","addedObserver","IntersectionObserver","ref","intersectionObserver","entries","observer","forEach","entry","intersectionRatio","trackedImpression","unobserve","observe","err","contentError","unsubscribe","dataOnly","useData","renderScript","Tag","data-template-variant-id","defineProperty","exports","TARGET","Symbol","UNSUBSCRIBE","concatPath","shallowClone","onChange","applyPath","applyPrevious","proxyTarget","inApply","changed","isUnsubscribed","equals","is","propCache","WeakMap","pathCache","proxyCache","handleChange","previous","item_1","callback","walkPath","invalidateCachedDescriptor","target","get","delete","buildProxy","proxy","handler","ignoreChange","ignoreSymbols","receiver","Reflect","isPrimitive","RegExp","isBuiltinWithoutMutableMethods","isShallow","descriptor","Map","getOwnPropertyDescriptor","configurable","writable","ignore","result","deleteProperty","apply","thisArg","argumentsList","compare","Date","valueOf","call","lastIndexOf","bind","module","nextTick","debounceNextTick","debounceNextTickImpl","enumerable","arguments","next","throttle","func","wait","later","leading","now","remaining","clearTimeout","trailing","BuilderMetaContext","ampMode","debounce","immediate","fontsLoaded","fetch","require","sizeMap","decorator","fnArgs","descriptorChecker","descriptorKey","Throttle","fetchCache","tryEval","searchToObject","pairs","search","pair","decodeURIComponent","_super","BehaviorSubject","updateState","info","data_1","_b","deviceSize","deviceSizeState","resizeFn","mounted","notifyStateChange","title","pageTitle","description","pageDescription","document","descriptionTag","querySelector","createElement","setAttribute","head","appendChild","inputs","input","defaultValue","newState","locationState","device","jsCode","skip","lastJsCode","httpRequests","noAsync","url","finalUrl_1","evalExpression","lastHttpRequests","builderModelMatch","throttledHandleRequest","currentSubscription","httpSubscriptionPerKey","newSubscription","onStateChange","newUrl","handleRequest","_hydrate","hydrate","getHtmlData","apiKey","onContentLoaded","BuilderPage","model","script","innerText","getUserAttributes","pathname","query","innerWidth","elementOrSelector","fresh","element","Element","exists","classList","contains","shouldHydrate","innerHTML","apiStyles_1","previousElementSibling","keepStyles_1","el","useElement","useEl","div","insertAdjacentElement","val_1","ReactDOM","render","builderRootRef","val","asServer","resizeListener","messageListener","dispatchEvent","CustomEvent","detail","nextState","font","family","kind","fileUrl","files","regular","weight","weightUrl","allowCustomFonts","customFonts","getCssFromFont","useContent","cssCode","getFontCss","prevProps","styleRef","getCss","builderContent","dataString","hash","WrapComponent","toUTCString","contentRef","inlineContent","fullData","checkStyles","testVariationId","propertyName","ctx","request","requestStart","time","json","err_1","timeEnd","existing","req","promise_1","promise","optionsString","__decorate","withChildren","HOC","forwardRef","builderOptions","canHaveChildren","isReact"],"mappings":"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"}